<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#0a0a0f">
    <title id="pageTitle">æ·±å‘¼å¸</title>
    <style>
        :root{--bg:#0a0a0f;--card:rgba(255,255,255,0.03);--card-border:rgba(255,255,255,0.06);--accent:#818cf8;--accent2:#6366f1;--accent-glow:rgba(129,140,248,0.15);--text:#fafafa;--text2:rgba(255,255,255,0.5);--text3:rgba(255,255,255,0.25)}
        *{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent;user-select:none}
        body{font-family:'SF Pro Display',-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;background:var(--bg);min-height:100vh;min-height:100dvh;color:var(--text);overflow-x:hidden}
        .app{max-width:430px;margin:0 auto;min-height:100vh;min-height:100dvh;position:relative}
        .home{padding:0 20px 40px}
        .glow-top{position:fixed;top:-200px;left:50%;transform:translateX(-50%);width:600px;height:400px;background:radial-gradient(ellipse,var(--accent-glow),transparent 70%);pointer-events:none;z-index:0}
        .header{padding:60px 0 40px;text-align:center;position:relative;z-index:1}
        .logo{font-size:32px;font-weight:600;letter-spacing:-0.5px;background:linear-gradient(135deg,#fff,rgba(255,255,255,0.7));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
        .tagline{font-size:13px;color:var(--text2);margin-top:8px;font-weight:400}
        .mood-card{background:var(--card);backdrop-filter:blur(20px);border:1px solid var(--card-border);border-radius:24px;padding:28px;margin-bottom:24px;position:relative;z-index:1}
        .mood-label{font-size:15px;font-weight:500;margin-bottom:20px;color:var(--text)}
        .mood-grid{display:flex;flex-wrap:wrap;gap:10px}
        .mood-btn{background:rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.08);border-radius:100px;padding:10px 18px;font-size:14px;color:var(--text);cursor:pointer;transition:all .2s;display:flex;align-items:center;gap:6px}
        .mood-btn:active,.mood-btn.selected{background:var(--accent);border-color:var(--accent);transform:scale(0.97)}
        .recommend{display:none;background:linear-gradient(135deg,rgba(129,140,248,0.1),rgba(99,102,241,0.05));border:1px solid rgba(129,140,248,0.2);border-radius:20px;padding:20px;margin-bottom:24px;position:relative;z-index:1}
        .recommend.show{display:block;animation:slideUp .3s ease}
        @keyframes slideUp{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
        .recommend-label{font-size:13px;color:var(--accent);margin-bottom:14px;font-weight:500}
        .recommend-btns{display:flex;gap:10px;flex-wrap:wrap}
        .recommend-btn{background:rgba(255,255,255,0.06);border:1px solid rgba(255,255,255,0.1);border-radius:100px;padding:10px 20px;font-size:14px;color:#fff;cursor:pointer}
        .modules{display:grid;grid-template-columns:repeat(2,1fr);gap:14px;position:relative;z-index:1}
        .module{background:var(--card);border:1px solid var(--card-border);border-radius:20px;padding:24px 20px;cursor:pointer;transition:all .2s;position:relative;overflow:hidden}
        .module:active{transform:scale(0.98);background:rgba(255,255,255,0.05)}
        .module-icon{font-size:28px;margin-bottom:12px}
        .module-name{font-size:15px;font-weight:500;color:var(--text)}
        .module-desc{font-size:12px;color:var(--text2);margin-top:4px}
        .module::after{content:'';position:absolute;top:0;right:0;width:80px;height:80px;background:radial-gradient(circle at 100% 0%,var(--accent-glow),transparent);opacity:0;transition:opacity .3s}
        .module:active::after{opacity:1}
        .page{display:none;position:fixed;top:0;left:0;right:0;bottom:0;background:var(--bg);z-index:100}
        .page.active{display:flex;flex-direction:column;animation:pageIn .3s ease}
        @keyframes pageIn{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
        .page-header{display:flex;align-items:center;padding:16px 20px;gap:16px}
        .back-btn{width:40px;height:40px;border-radius:12px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.08);color:var(--text);font-size:18px;cursor:pointer;display:flex;align-items:center;justify-content:center}
        .page-title{font-size:17px;font-weight:500}
        .page-content{flex:1;display:flex;flex-direction:column;align-items:center;padding:20px;overflow-y:auto}
        .science{background:linear-gradient(135deg,rgba(129,140,248,0.08),rgba(99,102,241,0.03));border:1px solid rgba(129,140,248,0.15);border-radius:16px;padding:16px 18px;margin-bottom:28px;width:100%;max-width:360px}
        .science-title{font-size:12px;color:var(--accent);font-weight:600;margin-bottom:8px;text-transform:uppercase;letter-spacing:0.5px}
        .science-text{font-size:13px;color:var(--text2);line-height:1.6}
        .breath-visual{width:200px;height:200px;position:relative;margin-bottom:40px}
        .breath-ring{position:absolute;top:0;left:0;width:100%;height:100%;border-radius:50%;border:2px solid rgba(129,140,248,0.2);transition:all 4s ease-in-out}
        .breath-ring.inhale{transform:scale(1.3);border-color:var(--accent);box-shadow:0 0 60px var(--accent-glow)}
        .breath-ring.exhale{transform:scale(0.7);border-color:rgba(129,140,248,0.3)}
        .breath-core{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:120px;height:120px;border-radius:50%;background:radial-gradient(circle,rgba(129,140,248,0.3),transparent);display:flex;align-items:center;justify-content:center}
        .breath-num{font-size:56px;font-weight:200;color:var(--text)}
        .breath-status{font-size:18px;color:var(--text2);margin-bottom:8px}
        .breath-progress{font-size:13px;color:var(--text3)}
        .breath-btn{margin-top:36px;background:linear-gradient(135deg,var(--accent),var(--accent2));border:none;border-radius:100px;padding:16px 48px;font-size:15px;font-weight:500;color:#fff;cursor:pointer}
        .breath-modes{display:flex;gap:10px;margin-top:20px}
        .breath-mode{background:rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.08);border-radius:100px;padding:10px 18px;font-size:13px;color:var(--text2);cursor:pointer}
        .breath-mode.active{background:rgba(129,140,248,0.15);border-color:var(--accent);color:var(--text)}
        .daze-wrap{position:fixed;top:0;left:0;right:0;bottom:0}
        .daze-canvas{width:100%;height:100%}
        .daze-ui{position:absolute;bottom:80px;left:0;right:0;text-align:center}
        .daze-time{font-size:64px;font-weight:100;color:rgba(255,255,255,0.15)}
        .daze-hint{font-size:13px;color:rgba(255,255,255,0.1);margin-top:12px}
        .daze-close{position:absolute;top:20px;right:20px;width:44px;height:44px;border-radius:50%;background:rgba(255,255,255,0.05);border:none;color:rgba(255,255,255,0.3);font-size:18px;cursor:pointer}
        .bubble-area{position:absolute;top:70px;left:0;right:0;bottom:100px}
        .bubble{position:absolute;border-radius:50%;cursor:pointer;animation:bobble 3s ease-in-out infinite}
        .bubble-inner{width:100%;height:100%;border-radius:50%;background:radial-gradient(circle at 30% 30%,rgba(255,255,255,0.95),rgba(129,140,248,0.4) 50%,rgba(99,102,241,0.2));box-shadow:inset 0 -15px 30px rgba(99,102,241,0.2),0 10px 30px rgba(0,0,0,0.2)}
        .bubble-shine{position:absolute;top:15%;left:20%;width:30%;height:20%;background:linear-gradient(135deg,rgba(255,255,255,0.8),transparent);border-radius:50%;transform:rotate(-40deg)}
        @keyframes bobble{0%,100%{transform:translateY(0) rotate(0deg)}50%{transform:translateY(-12px) rotate(2deg)}}
        .bubble.pop .bubble-inner{animation:popBubble .2s forwards}
        @keyframes popBubble{to{transform:scale(1.4);opacity:0}}
        .bubble-footer{position:absolute;bottom:0;left:0;right:0;padding:20px;background:linear-gradient(transparent,var(--bg))}
        .bubble-score{text-align:center;font-size:15px;color:var(--text)}
        .bubble-score span{color:var(--accent);font-weight:600;font-size:24px}
        .tear-wrap{width:100%;max-width:380px}
        .paper-picker{display:flex;gap:12px;margin-bottom:24px;justify-content:center}
        .paper-opt{width:52px;height:64px;border-radius:12px;border:2px solid transparent;cursor:pointer;transition:all .25s;position:relative;overflow:hidden}
        .paper-opt.active{border-color:var(--accent);transform:scale(1.08);box-shadow:0 8px 24px rgba(129,140,248,0.3)}
        .paper-opt::after{content:'';position:absolute;bottom:0;left:0;right:0;height:50%;background:linear-gradient(transparent,rgba(0,0,0,0.1))}
        .paper-opt.p-cream{background:linear-gradient(180deg,#fef9e7,#fdf2c7)}
        .paper-opt.p-rose{background:linear-gradient(180deg,#fdf2f8,#fbcfe8)}
        .paper-opt.p-sky{background:linear-gradient(180deg,#f0f9ff,#bae6fd)}
        .paper-opt.p-slate{background:linear-gradient(180deg,#334155,#1e293b)}
        .paper-opt.p-amber{background:linear-gradient(180deg,#d6d3d1,#a8a29e)}
        .paper-card{width:100%;aspect-ratio:4/3;border-radius:16px;padding:24px;position:relative;box-shadow:0 20px 60px rgba(0,0,0,0.4);transition:all .3s}
        .paper-card.p-cream{background:linear-gradient(180deg,#fef9e7,#fdf2c7);color:#78350f}
        .paper-card.p-rose{background:linear-gradient(180deg,#fdf2f8,#fbcfe8);color:#9d174d}
        .paper-card.p-sky{background:linear-gradient(180deg,#f0f9ff,#bae6fd);color:#0c4a6e}
        .paper-card.p-slate{background:linear-gradient(180deg,#334155,#1e293b);color:#cbd5e1}
        .paper-card.p-amber{background:linear-gradient(180deg,#d6d3d1,#a8a29e);color:#44403c}
        .paper-card textarea{width:100%;height:100%;background:transparent;border:none;outline:none;font-size:16px;color:inherit;resize:none;line-height:2;font-family:inherit}
        .paper-card textarea::placeholder{color:inherit;opacity:0.3}
        .paper-lines{position:absolute;top:60px;left:24px;right:24px;bottom:24px;background-size:100% 32px;pointer-events:none;opacity:0.08}
        .p-cream .paper-lines,.p-amber .paper-lines{background:repeating-linear-gradient(transparent,transparent 31px,#92400e 32px)}
        .p-rose .paper-lines{background:repeating-linear-gradient(transparent,transparent 31px,#be185d 32px)}
        .p-sky .paper-lines{background:repeating-linear-gradient(transparent,transparent 31px,#0369a1 32px)}
        .p-slate .paper-lines{background:repeating-linear-gradient(transparent,transparent 31px,#64748b 32px)}
        .tear-btns{display:flex;gap:12px;margin-top:28px;justify-content:center}
        .tear-btn{border:none;border-radius:100px;padding:16px 32px;font-size:15px;font-weight:500;color:#fff;cursor:pointer;display:flex;align-items:center;gap:8px;transition:all .2s}
        .tear-btn:active{transform:scale(0.96)}
        .btn-rip{background:linear-gradient(135deg,#8b5cf6,#7c3aed)}
        .btn-burn{background:linear-gradient(135deg,#f97316,#ea580c)}
        .destroy-scene{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.97);z-index:300;display:none;justify-content:center;align-items:center}
        .destroy-scene.active{display:flex;animation:fadeIn .4s}
        @keyframes fadeIn{from{opacity:0}to{opacity:1}}
        .destroy-stage{position:relative;width:300px;height:200px}
        .destroy-paper{width:100%;height:100%;border-radius:12px;padding:20px;font-size:14px;line-height:1.6;word-break:break-all;overflow:hidden;position:relative}
        .destroy-paper.ripping{animation:tearApart 2s forwards}
        @keyframes tearApart{0%{clip-path:inset(0);filter:brightness(1)}20%{clip-path:inset(0);filter:brightness(1.1);transform:rotate(-1deg)}40%{clip-path:polygon(0 0,55% 0,50% 30%,58% 60%,48% 100%,0 100%);transform:rotate(1deg)}70%{clip-path:polygon(0 0,25% 0,20% 40%,30% 70%,15% 100%,0 100%);transform:translateX(-50px) rotate(-10deg);opacity:0.6}100%{clip-path:polygon(0 0,0 0,0 100%,0 100%);transform:translateX(-100px) rotate(-20deg);opacity:0}}
        .destroy-paper.burning{animation:burnAway 2.8s forwards}
        @keyframes burnAway{0%{filter:brightness(1) sepia(0)}25%{filter:brightness(1.3) sepia(0.3)}50%{filter:brightness(1.8) sepia(0.8);clip-path:polygon(0 100%,100% 100%,100% 50%,85% 40%,70% 55%,50% 35%,30% 50%,15% 35%,0 45%)}75%{filter:brightness(2.5) sepia(1);clip-path:polygon(0 100%,100% 100%,100% 75%,80% 70%,60% 80%,40% 65%,20% 78%,0 70%)}100%{filter:brightness(4);clip-path:polygon(0 100%,100% 100%,100% 100%,0 100%);opacity:0}}
        .particle-layer{position:absolute;top:0;left:0;width:100%;height:100%;pointer-events:none;overflow:visible}
        .rip-particle{position:absolute;border-radius:3px;animation:particleFly 1.5s forwards}
        @keyframes particleFly{0%{opacity:1;transform:translate(0,0) rotate(0deg) scale(1)}100%{opacity:0;transform:translate(var(--x),var(--y)) rotate(var(--r)) scale(0.3)}}
        .fire-particle{position:absolute;border-radius:50%;animation:fireRise 1s forwards}
        @keyframes fireRise{0%{opacity:1;transform:translateY(0) scale(1)}100%{opacity:0;transform:translateY(-150px) scale(0)}}
        .ember{position:absolute;border-radius:50%;animation:emberFloat 3s forwards}
        @keyframes emberFloat{0%{opacity:0.7;transform:translateY(0) scale(1)}100%{opacity:0;transform:translateY(calc(100vh - var(--start))) rotate(600deg) scale(0.5)}}
        .destroy-done{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);text-align:center;opacity:0;pointer-events:none}
        .destroy-done.show{opacity:1;pointer-events:auto;animation:doneIn .6s .8s both}
        @keyframes doneIn{from{opacity:0;transform:translate(-50%,-50%) scale(0.8)}to{opacity:1;transform:translate(-50%,-50%) scale(1)}}
        .done-icon{font-size:80px;margin-bottom:24px;display:block}
        .done-title{font-size:24px;font-weight:300;color:#fff;margin-bottom:8px}
        .done-sub{font-size:14px;color:var(--text2);margin-bottom:36px}
        .done-btn{background:rgba(255,255,255,0.08);border:1px solid rgba(255,255,255,0.15);border-radius:100px;padding:14px 36px;color:#fff;font-size:14px;cursor:pointer}
        .sound-list{width:100%;max-width:380px}
        .sound-card{background:var(--card);border:1px solid var(--card-border);border-radius:16px;padding:18px;margin-bottom:12px;transition:all .2s}
        .sound-card.active{background:rgba(129,140,248,0.08);border-color:rgba(129,140,248,0.25)}
        .sound-row{display:flex;align-items:center;justify-content:space-between;cursor:pointer}
        .sound-info{display:flex;align-items:center;gap:14px}
        .sound-icon{font-size:24px}
        .sound-name{font-size:15px;font-weight:500}
        .sound-switch{width:48px;height:28px;border-radius:14px;background:rgba(255,255,255,0.1);position:relative;transition:background .3s}
        .sound-switch::after{content:'';position:absolute;top:3px;left:3px;width:22px;height:22px;border-radius:50%;background:#fff;transition:left .3s}
        .sound-card.active .sound-switch{background:var(--accent)}
        .sound-card.active .sound-switch::after{left:23px}
        .sound-vol{margin-top:14px;display:none}
        .sound-card.active .sound-vol{display:block}
        .vol-slider{width:100%;height:4px;-webkit-appearance:none;background:rgba(255,255,255,0.1);border-radius:2px}
        .vol-slider::-webkit-slider-thumb{-webkit-appearance:none;width:18px;height:18px;background:var(--accent);border-radius:50%;cursor:pointer}
        .master-card{background:var(--card);border:1px solid var(--card-border);border-radius:16px;padding:18px;margin-top:20px}
        .master-label{font-size:13px;color:var(--text2);margin-bottom:12px;display:flex;justify-content:space-between}
        .timer-row{display:flex;gap:10px;margin-top:20px;justify-content:center}
        .timer-opt{background:rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.08);border-radius:100px;padding:10px 18px;font-size:13px;color:var(--text2);cursor:pointer}
        .timer-opt.active{background:rgba(129,140,248,0.15);border-color:var(--accent);color:var(--text)}
        .timer-info{text-align:center;margin-top:12px;font-size:13px;color:var(--text3)}
        .touch-picker{display:flex;gap:8px;margin-bottom:24px;flex-wrap:wrap;justify-content:center}
        .touch-opt{background:rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.08);border-radius:100px;padding:10px 16px;font-size:13px;color:var(--text2);cursor:pointer}
        .touch-opt.active{background:rgba(129,140,248,0.15);border-color:var(--accent);color:var(--text)}
        .touch-canvas{width:100%;max-width:340px;aspect-ratio:1;border-radius:24px;overflow:hidden;position:relative}
        .touch-tip{text-align:center;font-size:13px;color:var(--text3);margin-top:18px;line-height:1.6}
        .ball-scene{width:100%;height:100%;background:radial-gradient(circle at 50% 60%,#1e1b4b,#0a0a0f);display:flex;align-items:center;justify-content:center;position:relative}
        .stress-ball{width:55%;aspect-ratio:1;border-radius:50%;background:radial-gradient(circle at 30% 25%,#fda4af,#fb7185 35%,#e11d48 70%,#9f1239);box-shadow:0 40px 80px rgba(0,0,0,0.5),inset 0 -25px 50px rgba(0,0,0,0.3),inset 0 15px 40px rgba(255,255,255,0.15);cursor:pointer;transition:none;transform-origin:center center}
        .ball-shadow{position:absolute;bottom:40px;width:45%;height:12px;background:radial-gradient(ellipse,rgba(0,0,0,0.5),transparent 70%);border-radius:50%;transition:all .1s}
        .ball-hint{position:absolute;bottom:24px;font-size:13px;color:var(--text3)}
        .sand-scene{width:100%;height:100%;position:relative}
        .sand-cv{width:100%;height:100%;touch-action:none}
        .sand-overlay{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);text-align:center;color:var(--text3);pointer-events:none;transition:opacity .5s}
        .sand-overlay.hidden{opacity:0}
        .sand-icon{font-size:48px;margin-bottom:12px}
        .sand-text{font-size:14px;line-height:1.6}
        .sand-clear{position:absolute;top:12px;right:12px;width:44px;height:44px;border-radius:12px;background:rgba(0,0,0,0.3);border:none;font-size:20px;cursor:pointer}
        .zen-scene{width:100%;height:100%;position:relative}
        .zen-cv{width:100%;height:100%;touch-action:none;background:#faf8f5;border-radius:20px}
        .zen-tabs{position:absolute;top:12px;left:12px;right:12px;display:flex;gap:8px;justify-content:center}
        .zen-tab{background:rgba(0,0,0,0.06);border:none;border-radius:8px;padding:8px 14px;font-size:12px;color:#666;cursor:pointer}
        .zen-tab.active{background:var(--accent);color:#fff}
        .zen-status{position:absolute;bottom:16px;left:50%;transform:translateX(-50%);font-size:12px;color:#999}
        /* æ‰“æ²™è¢‹æ ·å¼ */
        .bag-scene{width:100%;height:100%;background:linear-gradient(180deg,#1a1a2e 0%,#16213e 100%);position:relative;overflow:hidden}
        .bag-ceiling{position:absolute;top:0;left:0;right:0;height:30px;background:linear-gradient(180deg,#0f0f1a,#1a1a2e)}
        .bag-chain{position:absolute;top:30px;left:50%;width:4px;height:40px;background:linear-gradient(90deg,#4a4a4a,#6a6a6a,#4a4a4a);transform:translateX(-50%)}
        .punching-bag{position:absolute;top:70px;left:50%;width:90px;height:160px;transform:translateX(-50%);transform-origin:top center;transition:transform 0.1s}
        .bag-top{width:100%;height:25px;background:radial-gradient(ellipse at center,#8b0000,#5c0000);border-radius:50% 50% 0 0}
        .bag-body{width:100%;height:110px;background:linear-gradient(90deg,#5c0000 0%,#8b0000 30%,#a00000 50%,#8b0000 70%,#5c0000 100%);position:relative}
        .bag-body::before{content:'';position:absolute;top:20px;left:50%;transform:translateX(-50%);width:60%;height:3px;background:rgba(255,255,255,0.1);border-radius:2px}
        .bag-body::after{content:'';position:absolute;bottom:20px;left:50%;transform:translateX(-50%);width:60%;height:3px;background:rgba(255,255,255,0.1);border-radius:2px}
        .bag-bottom{width:100%;height:25px;background:radial-gradient(ellipse at center,#8b0000,#5c0000);border-radius:0 0 50% 50%}
        .bag-highlight{position:absolute;top:30px;left:15px;width:15px;height:80px;background:linear-gradient(180deg,rgba(255,255,255,0.15),transparent);border-radius:10px}
        .boxer{position:absolute;bottom:30px;left:50%;transform:translateX(-50%);text-align:center}
        .boxer-body{font-size:80px;line-height:1;transition:transform 0.08s}
        .boxer-body.punch-left{transform:translateX(-15px) rotate(-8deg)}
        .boxer-body.punch-right{transform:translateX(15px) rotate(8deg)}
        .punch-effect{position:absolute;pointer-events:none;font-size:32px;animation:punchPop 0.4s forwards;opacity:0}
        @keyframes punchPop{0%{opacity:1;transform:scale(0.5)}50%{opacity:1;transform:scale(1.3)}100%{opacity:0;transform:scale(1.5) translateY(-20px)}}
        .bag-stats{position:absolute;bottom:20px;left:0;right:0;text-align:center}
        .bag-count{font-size:28px;font-weight:600;color:var(--accent)}
        .bag-label{font-size:12px;color:var(--text3);margin-top:4px}
        .combo-display{position:absolute;top:100px;left:50%;transform:translateX(-50%);font-size:20px;font-weight:700;color:#fbbf24;opacity:0;transition:opacity 0.2s}
        .combo-display.show{opacity:1;animation:comboPulse 0.3s}
        @keyframes comboPulse{0%{transform:translateX(-50%) scale(1)}50%{transform:translateX(-50%) scale(1.2)}100%{transform:translateX(-50%) scale(1)}}
        .footer{text-align:center;padding:40px 20px;font-size:12px;color:var(--text3)}
    </style>
</head>
<body>
    <div class="app">
        <div class="glow-top"></div>
        <div class="home" id="home">
            <div class="header">
                <div class="logo">æ·±å‘¼å¸</div>
                <div class="tagline">åŸºäºè„‘ç§‘å­¦çš„å³æ—¶è§£å‹</div>
            </div>
            <div class="mood-card">
                <div class="mood-label">ç°åœ¨æ„Ÿè§‰æ€ä¹ˆæ ·ï¼Ÿ</div>
                <div class="mood-grid">
                    <button class="mood-btn" onclick="pickMood(this,'anxious')"><span>ğŸ˜°</span>ç„¦è™‘</button>
                    <button class="mood-btn" onclick="pickMood(this,'sad')"><span>ğŸ˜”</span>ä½è½</button>
                    <button class="mood-btn" onclick="pickMood(this,'angry')"><span>ğŸ˜¤</span>çƒ¦èº</button>
                    <button class="mood-btn" onclick="pickMood(this,'tired')"><span>ğŸ¥±</span>ç–²æƒ«</button>
                    <button class="mood-btn" onclick="pickMood(this,'meh')"><span>ğŸ˜¶</span>è¯´ä¸æ¸…</button>
                </div>
            </div>
            <div class="recommend" id="recommend">
                <div class="recommend-label">ğŸ’¡ ä¸ºä½ æ¨è</div>
                <div class="recommend-btns" id="recommendBtns"></div>
            </div>
            <div class="modules">
                <div class="module" onclick="go('breath')"><div class="module-icon">ğŸ«</div><div class="module-name">å‘¼å¸</div><div class="module-desc">4-7-8 ç§‘å­¦å‘¼å¸</div></div>
                <div class="module" onclick="go('daze')"><div class="module-icon">ğŸŒ€</div><div class="module-name">å‘å‘†</div><div class="module-desc">3åˆ†é’Ÿæ”¾ç©º</div></div>
                <div class="module" onclick="go('bubble')"><div class="module-icon">ğŸ«§</div><div class="module-name">æ³¡æ³¡</div><div class="module-desc">æçˆ†è§£å‹</div></div>
                <div class="module" onclick="go('tear')"><div class="module-icon">ğŸ“„</div><div class="module-name">æ’•çº¸</div><div class="module-desc">å†™ä¸‹çƒ¦æ¼é”€æ¯</div></div>
                <div class="module" onclick="go('sound')"><div class="module-icon">ğŸµ</div><div class="module-name">å£°éŸ³</div><div class="module-desc">è‡ªç„¶ç™½å™ªéŸ³</div></div>
                <div class="module" onclick="go('touch')"><div class="module-icon">ğŸ–ï¸</div><div class="module-name">è§¦æ„Ÿ</div><div class="module-desc">è§£å‹çƒ/æ²™è¢‹</div></div>
            </div>
            <div class="footer">æ¯ä¸ªåŠŸèƒ½éƒ½æœ‰ç§‘å­¦ä¾æ®</div>
        </div>
    </div>

    <div class="page" id="breath-page">
        <div class="page-header"><button class="back-btn" onclick="back()">â†</button><div class="page-title">ç§‘å­¦å‘¼å¸</div></div>
        <div class="page-content">
            <div class="science"><div class="science-title">ğŸ”¬ åŸç†</div><div class="science-text">4-7-8å‘¼å¸æ³•æ¿€æ´»è¿·èµ°ç¥ç»ï¼Œè§¦å‘å‰¯äº¤æ„Ÿç¥ç»"ä¼‘æ¯-æ¶ˆåŒ–"ååº”ï¼Œ60ç§’å†…é™ä½å¿ƒç‡ã€‚</div></div>
            <div class="breath-visual"><div class="breath-ring" id="breathRing"></div><div class="breath-core"><div class="breath-num" id="breathNum">4</div></div></div>
            <div class="breath-status" id="breathStatus">å‡†å¤‡å¥½äº†å—ï¼Ÿ</div>
            <div class="breath-progress" id="breathProgress"></div>
            <button class="breath-btn" id="breathBtn" onclick="toggleBreath()">å¼€å§‹</button>
            <div class="breath-modes"><button class="breath-mode active" onclick="setMode(this,'478')">4-7-8</button><button class="breath-mode" onclick="setMode(this,'box')">æ–¹å—å‘¼å¸</button></div>
        </div>
    </div>

    <div class="page" id="daze-page">
        <div class="daze-wrap"><button class="daze-close" onclick="back()">âœ•</button><canvas class="daze-canvas" id="dazeCanvas"></canvas><div class="daze-ui"><div class="daze-time" id="dazeTime">3:00</div><div class="daze-hint">ä»€ä¹ˆéƒ½ä¸ç”¨åš</div></div></div>
    </div>

    <div class="page" id="bubble-page">
        <div class="page-header"><button class="back-btn" onclick="back()">â†</button><div class="page-title">ææ³¡æ³¡</div></div>
        <div class="bubble-area" id="bubbleArea"></div>
        <div class="bubble-footer"><div class="bubble-score">å·²æçˆ† <span id="bubbleScore">0</span> ä¸ª</div></div>
    </div>

    <div class="page" id="tear-page">
        <div class="page-header"><button class="back-btn" onclick="back()">â†</button><div class="page-title">æ’•æ‰çƒ¦æ¼</div></div>
        <div class="page-content">
            <div class="science"><div class="science-title">ğŸ”¬ åŸç†</div><div class="science-text">è¡¨è¾¾æ€§å†™ä½œé™ä½ç„¦è™‘ï¼Œå°†è´Ÿé¢æƒ…ç»ª"é”€æ¯"è±¡å¾æ€§å‘Šåˆ«ã€‚</div></div>
            <div class="tear-wrap">
                <div class="paper-picker">
                    <div class="paper-opt p-cream active" onclick="setPaper('cream')"></div>
                    <div class="paper-opt p-rose" onclick="setPaper('rose')"></div>
                    <div class="paper-opt p-sky" onclick="setPaper('sky')"></div>
                    <div class="paper-opt p-slate" onclick="setPaper('slate')"></div>
                    <div class="paper-opt p-amber" onclick="setPaper('amber')"></div>
                </div>
                <div class="paper-card p-cream" id="paperCard">
                    <textarea id="paperText" placeholder="å†™ä¸‹è®©ä½ çƒ¦æ¼çš„äº‹..."></textarea>
                    <div class="paper-lines"></div>
                </div>
                <div class="tear-btns">
                    <button class="tear-btn btn-rip" onclick="destroy('rip')">âœ‚ï¸ æ’•ç¢</button>
                    <button class="tear-btn btn-burn" onclick="destroy('burn')">ğŸ”¥ ç„šçƒ§</button>
                </div>
            </div>
        </div>
    </div>

    <div class="destroy-scene" id="destroyScene">
        <div class="destroy-stage" id="destroyStage">
            <div class="destroy-paper" id="destroyPaper"></div>
            <div class="particle-layer" id="particleLayer"></div>
        </div>
        <div class="destroy-done" id="destroyDone">
            <span class="done-icon" id="doneIcon">âœ¨</span>
            <div class="done-title" id="doneTitle">çƒ¦æ¼å·²æ¶ˆæ•£</div>
            <div class="done-sub">è®©è¿‡å»çš„è¿‡å»ï¼Œæ‹¥æŠ±æ–°çš„å¼€å§‹</div>
            <button class="done-btn" onclick="closeDest()">ç»§ç»­å‰è¡Œ</button>
        </div>
    </div>

    <div class="page" id="sound-page">
        <div class="page-header"><button class="back-btn" onclick="back()">â†</button><div class="page-title">å£°éŸ³ç–—æ„ˆ</div></div>
        <div class="page-content">
            <div class="science"><div class="science-title">ğŸ”¬ åŸç†</div><div class="science-text">ç‰¹å®šé¢‘ç‡å£°éŸ³å½±å“è„‘ç”µæ³¢ï¼Œè‡ªç„¶éŸ³å”¤èµ·å®‰å…¨æ„Ÿï¼Œé™ä½çš®è´¨é†‡ã€‚</div></div>
            <div class="sound-list">
                <div class="sound-card" data-sound="rain"><div class="sound-row" onclick="toggleSnd(this.parentElement)"><div class="sound-info"><span class="sound-icon">ğŸŒ§ï¸</span><span class="sound-name">é›¨å£°</span></div><div class="sound-switch"></div></div><div class="sound-vol"><input type="range" class="vol-slider" min="0" max="100" value="70" oninput="setSndVol(this)"></div></div>
                <div class="sound-card" data-sound="wave"><div class="sound-row" onclick="toggleSnd(this.parentElement)"><div class="sound-info"><span class="sound-icon">ğŸŒŠ</span><span class="sound-name">æµ·æµª</span></div><div class="sound-switch"></div></div><div class="sound-vol"><input type="range" class="vol-slider" min="0" max="100" value="70" oninput="setSndVol(this)"></div></div>
                <div class="sound-card" data-sound="fire"><div class="sound-row" onclick="toggleSnd(this.parentElement)"><div class="sound-info"><span class="sound-icon">ğŸ”¥</span><span class="sound-name">ç¯ç«</span></div><div class="sound-switch"></div></div><div class="sound-vol"><input type="range" class="vol-slider" min="0" max="100" value="70" oninput="setSndVol(this)"></div></div>
                <div class="sound-card" data-sound="white"><div class="sound-row" onclick="toggleSnd(this.parentElement)"><div class="sound-info"><span class="sound-icon">ğŸ“»</span><span class="sound-name">ç™½å™ªéŸ³</span></div><div class="sound-switch"></div></div><div class="sound-vol"><input type="range" class="vol-slider" min="0" max="100" value="70" oninput="setSndVol(this)"></div></div>
                <div class="master-card"><div class="master-label"><span>æ€»éŸ³é‡</span><span id="masterVal">50%</span></div><input type="range" class="vol-slider" id="masterVol" min="0" max="100" value="50" oninput="setMaster(this.value)"></div>
                <div class="timer-row"><button class="timer-opt" onclick="setTimer(this,15)">15åˆ†é’Ÿ</button><button class="timer-opt" onclick="setTimer(this,30)">30åˆ†é’Ÿ</button><button class="timer-opt" onclick="setTimer(this,60)">60åˆ†é’Ÿ</button></div>
                <div class="timer-info" id="timerInfo"></div>
            </div>
        </div>
    </div>

    <div class="page" id="touch-page">
        <div class="page-header"><button class="back-btn" onclick="back()">â†</button><div class="page-title">è§¦æ„Ÿè§£å‹</div></div>
        <div class="page-content">
            <div class="science"><div class="science-title">ğŸ”¬ åŸç†</div><div class="science-text">é‡å¤æ‰‹éƒ¨åŠ¨ä½œæ¿€æ´»ç¨‹åºæ€§è®°å¿†ï¼Œç»•è¿‡ç„¦è™‘ç›¸å…³å‰é¢å¶ï¼Œè¿›å…¥å¿ƒæµã€‚</div></div>
            <div class="touch-picker">
                <button class="touch-opt active" onclick="setTouch('ball')">ğŸ”® è§£å‹çƒ</button>
                <button class="touch-opt" onclick="setTouch('bag')">ğŸ¥Š æ‰“æ²™è¢‹</button>
                <button class="touch-opt" onclick="setTouch('sand')">ğŸ–ï¸ æ²™ç›˜</button>
                <button class="touch-opt" onclick="setTouch('zen')">ğŸŒ€ ç¦…ç»•</button>
            </div>
            <div class="touch-canvas" id="touchCanvas"></div>
            <div class="touch-tip" id="touchTip">æŒ‰ä½çƒä½“ï¼Œæ„Ÿå—å˜å½¢</div>
        </div>
    </div>

<script>
let audioCtx=null;
function getAudio(){if(!audioCtx)audioCtx=new(window.AudioContext||window.webkitAudioContext)();if(audioCtx.state==='suspended')audioCtx.resume();return audioCtx}
function playRipSound(){const ctx=getAudio(),dur=0.6;const noise=ctx.createBufferSource(),buf=ctx.createBuffer(1,ctx.sampleRate*dur,ctx.sampleRate),d=buf.getChannelData(0);for(let i=0;i<buf.length;i++)d[i]=(Math.random()*2-1)*Math.exp(-i/(buf.length*0.2))*(1+Math.random()*0.5);noise.buffer=buf;const hp=ctx.createBiquadFilter();hp.type='highpass';hp.frequency.value=800;const g=ctx.createGain();g.gain.setValueAtTime(0.4,ctx.currentTime);g.gain.exponentialRampToValueAtTime(0.01,ctx.currentTime+dur);noise.connect(hp);hp.connect(g);g.connect(ctx.destination);noise.start()}
function playBurnSound(){const ctx=getAudio(),dur=2.5;const noise=ctx.createBufferSource(),buf=ctx.createBuffer(1,ctx.sampleRate*dur,ctx.sampleRate),d=buf.getChannelData(0);for(let i=0;i<buf.length;i++){let env=Math.exp(-i/(buf.length*0.5));d[i]=(Math.random()*2-1)*env*0.3;if(Math.random()<0.01)d[i]+=Math.random()*0.5*env}noise.buffer=buf;const lp=ctx.createBiquadFilter();lp.type='lowpass';lp.frequency.value=1500;const g=ctx.createGain();g.gain.setValueAtTime(0.5,ctx.currentTime);noise.connect(lp);lp.connect(g);g.connect(ctx.destination);noise.start()}
function playDoneSound(){const ctx=getAudio();[523.25,659.25,783.99].forEach((f,i)=>{const o=ctx.createOscillator(),g=ctx.createGain();o.type='sine';o.frequency.value=f;g.gain.setValueAtTime(0,ctx.currentTime+i*0.15);g.gain.linearRampToValueAtTime(0.15,ctx.currentTime+i*0.15+0.05);g.gain.exponentialRampToValueAtTime(0.01,ctx.currentTime+i*0.15+0.4);o.connect(g);g.connect(ctx.destination);o.start(ctx.currentTime+i*0.15);o.stop(ctx.currentTime+i*0.15+0.5)})}
function playPopSound(){const ctx=getAudio(),o=ctx.createOscillator(),g=ctx.createGain();o.type='sine';o.frequency.setValueAtTime(900+Math.random()*400,ctx.currentTime);o.frequency.exponentialRampToValueAtTime(150,ctx.currentTime+0.1);g.gain.setValueAtTime(0.3,ctx.currentTime);g.gain.exponentialRampToValueAtTime(0.01,ctx.currentTime+0.1);o.connect(g);g.connect(ctx.destination);o.start();o.stop(ctx.currentTime+0.1)}
function playPunchSound(){const ctx=getAudio(),dur=0.15;const noise=ctx.createBufferSource(),buf=ctx.createBuffer(1,ctx.sampleRate*dur,ctx.sampleRate),d=buf.getChannelData(0);for(let i=0;i<buf.length;i++)d[i]=(Math.random()*2-1)*Math.exp(-i/(buf.length*0.08));noise.buffer=buf;const lp=ctx.createBiquadFilter();lp.type='lowpass';lp.frequency.value=400;const g=ctx.createGain();g.gain.setValueAtTime(0.6,ctx.currentTime);g.gain.exponentialRampToValueAtTime(0.01,ctx.currentTime+dur);noise.connect(lp);lp.connect(g);g.connect(ctx.destination);noise.start()}
function vibrate(p){if(navigator.vibrate)navigator.vibrate(p)}

const moodMap={anxious:[{n:'ğŸ« å‘¼å¸',p:'breath'},{n:'ğŸ“» ç™½å™ªéŸ³',p:'sound'}],sad:[{n:'ğŸŒ§ï¸ é›¨å£°',p:'sound'},{n:'ğŸŒ€ å‘å‘†',p:'daze'}],angry:[{n:'ğŸ¥Š æ‰“æ²™è¢‹',p:'touch'},{n:'ğŸ“„ æ’•çº¸',p:'tear'}],tired:[{n:'ğŸ”¥ ç¯ç«',p:'sound'},{n:'ğŸŒ€ å‘å‘†',p:'daze'}],meh:[{n:'ğŸ« å‘¼å¸',p:'breath'},{n:'ğŸ–ï¸ è§¦æ„Ÿ',p:'touch'}]};
function pickMood(btn,mood){document.querySelectorAll('.mood-btn').forEach(b=>b.classList.remove('selected'));btn.classList.add('selected');vibrate(20);const rec=document.getElementById('recommend'),btns=document.getElementById('recommendBtns');btns.innerHTML=moodMap[mood].map(m=>`<button class="recommend-btn" onclick="go('${m.p}')">${m.n}</button>`).join('');rec.classList.add('show')}
function go(p){document.getElementById(p+'-page').classList.add('active');document.getElementById('home').style.display='none';document.getElementById('pageTitle').textContent=p;if(p==='bubble')initBubbles();if(p==='daze')initDaze();if(p==='touch')setTouch('ball');vibrate(20)}
function back(){document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));document.getElementById('home').style.display='block';stopBreath();stopDaze();stopSounds();stopBall()}

let breathInt=null,bPhase=0,bCount=0,bTimer=0,bCfg={in:4,hold:7,out:8,rounds:4};
function setMode(btn,m){document.querySelectorAll('.breath-mode').forEach(b=>b.classList.remove('active'));btn.classList.add('active');bCfg=m==='478'?{in:4,hold:7,out:8,rounds:4}:{in:4,hold:4,out:4,hold2:4,rounds:4};document.getElementById('breathNum').textContent=bCfg.in}
function toggleBreath(){breathInt?stopBreath():startBreath()}
function startBreath(){bPhase=0;bCount=0;bTimer=bCfg.in;document.getElementById('breathBtn').textContent='åœæ­¢';document.getElementById('breathRing').className='breath-ring inhale';updateBreath();breathInt=setInterval(()=>{bTimer--;if(bTimer<=0){bPhase++;const max=bCfg.hold2?3:2;if(bPhase>max){bPhase=0;bCount++;if(bCount>=bCfg.rounds){doneBreath();return}}switch(bPhase){case 0:bTimer=bCfg.in;document.getElementById('breathRing').className='breath-ring inhale';break;case 1:bTimer=bCfg.hold;document.getElementById('breathRing').className='breath-ring';break;case 2:bTimer=bCfg.out;document.getElementById('breathRing').className='breath-ring exhale';break;case 3:bTimer=bCfg.hold2;document.getElementById('breathRing').className='breath-ring';break}vibrate(40)}updateBreath()},1000)}
function updateBreath(){document.getElementById('breathNum').textContent=bTimer;document.getElementById('breathStatus').textContent=['å¸æ°”','å±ä½','å‘¼æ°”','å±ä½'][bPhase];document.getElementById('breathProgress').textContent=`${bCount+1} / ${bCfg.rounds}`}
function stopBreath(){if(breathInt){clearInterval(breathInt);breathInt=null}document.getElementById('breathBtn').textContent='å¼€å§‹';document.getElementById('breathStatus').textContent='å‡†å¤‡å¥½äº†å—ï¼Ÿ';document.getElementById('breathProgress').textContent='';document.getElementById('breathRing').className='breath-ring';document.getElementById('breathNum').textContent=bCfg.in}
function doneBreath(){stopBreath();document.getElementById('breathStatus').textContent='âœ¨ å®Œæˆ';vibrate([80,40,80])}

let dazeInt=null,dazeT=180;
function initDaze(){const c=document.getElementById('dazeCanvas'),ctx=c.getContext('2d');c.width=window.innerWidth;c.height=window.innerHeight;dazeT=180;updDaze();const blobs=[];for(let i=0;i<5;i++)blobs.push({x:Math.random()*c.width,y:Math.random()*c.height,r:100+Math.random()*80,vx:(Math.random()-0.5)*0.4,vy:(Math.random()-0.5)*0.4,hue:250+Math.random()*50});(function draw(){ctx.fillStyle='rgba(10,10,15,0.02)';ctx.fillRect(0,0,c.width,c.height);blobs.forEach(b=>{b.x+=b.vx;b.y+=b.vy;if(b.x<0||b.x>c.width)b.vx*=-1;if(b.y<0||b.y>c.height)b.vy*=-1;const g=ctx.createRadialGradient(b.x,b.y,0,b.x,b.y,b.r);g.addColorStop(0,`hsla(${b.hue},70%,55%,0.25)`);g.addColorStop(1,'transparent');ctx.fillStyle=g;ctx.beginPath();ctx.arc(b.x,b.y,b.r,0,Math.PI*2);ctx.fill()});requestAnimationFrame(draw)})();dazeInt=setInterval(()=>{dazeT--;updDaze();if(dazeT<=0)back()},1000)}
function updDaze(){document.getElementById('dazeTime').textContent=`${Math.floor(dazeT/60)}:${(dazeT%60).toString().padStart(2,'0')}`}
function stopDaze(){if(dazeInt){clearInterval(dazeInt);dazeInt=null}}

let bubbleCnt=0;
function initBubbles(){const area=document.getElementById('bubbleArea');area.innerHTML='';bubbleCnt=0;document.getElementById('bubbleScore').textContent='0';for(let i=0;i<12;i++)makeBubble()}
function makeBubble(){const area=document.getElementById('bubbleArea'),b=document.createElement('div');b.className='bubble';const s=55+Math.random()*40;b.innerHTML='<div class="bubble-inner"><div class="bubble-shine"></div></div>';b.style.cssText=`width:${s}px;height:${s}px;left:${10+Math.random()*(area.offsetWidth-s-20)}px;top:${10+Math.random()*(area.offsetHeight-s-20)}px;animation-delay:${Math.random()*2}s`;b.onclick=b.ontouchstart=e=>{e.preventDefault();popIt(b)};area.appendChild(b)}
function popIt(b){if(b.classList.contains('pop'))return;playPopSound();vibrate([15,10,25]);b.classList.add('pop');bubbleCnt++;document.getElementById('bubbleScore').textContent=bubbleCnt;setTimeout(()=>{b.remove();makeBubble();if(Math.random()>0.4)makeBubble()},200)}

let paperStyle='cream';
function setPaper(s){paperStyle=s;document.querySelectorAll('.paper-opt').forEach(o=>o.classList.remove('active'));document.querySelector('.p-'+s).classList.add('active');document.getElementById('paperCard').className='paper-card p-'+s}
function destroy(mode){const text=document.getElementById('paperText').value;if(!text.trim()){vibrate(100);return}vibrate([40,20,40,20,80]);const scene=document.getElementById('destroyScene'),paper=document.getElementById('destroyPaper'),done=document.getElementById('destroyDone'),layer=document.getElementById('particleLayer');paper.className='destroy-paper p-'+paperStyle;paper.textContent=text.substring(0,80)+(text.length>80?'...':'');done.classList.remove('show');layer.innerHTML='';scene.classList.add('active');setTimeout(()=>{if(mode==='rip'){paper.classList.add('ripping');playRipSound();createRipParticles();document.getElementById('doneIcon').textContent='âœ‚ï¸';document.getElementById('doneTitle').textContent='ç¢ç‰‡å·²é£˜æ•£'}else{paper.classList.add('burning');playBurnSound();createFireParticles();createEmbers();document.getElementById('doneIcon').textContent='ğŸ”¥';document.getElementById('doneTitle').textContent='ç°é£çƒŸç­'}setTimeout(()=>{playDoneSound();done.classList.add('show')},mode==='rip'?1800:2500)},100)}
function createRipParticles(){const layer=document.getElementById('particleLayer'),colors=['#fef9e7','#fdf2c7','#fdf2f8','#e3f2fd','#d6d3d1'];for(let i=0;i<30;i++){const p=document.createElement('div');p.className='rip-particle';const w=12+Math.random()*25,h=15+Math.random()*35;p.style.cssText=`width:${w}px;height:${h}px;left:${30+Math.random()*40}%;top:${20+Math.random()*60}%;background:${colors[Math.floor(Math.random()*colors.length)]};--x:${(Math.random()-0.5)*500}px;--y:${150+Math.random()*250}px;--r:${Math.random()*1200}deg;animation-delay:${i*0.03}s`;layer.appendChild(p)}}
function createFireParticles(){const layer=document.getElementById('particleLayer'),colors=['#fbbf24','#f97316','#ef4444','#fcd34d'];for(let i=0;i<50;i++){const p=document.createElement('div');p.className='fire-particle';const s=5+Math.random()*10;p.style.cssText=`width:${s}px;height:${s}px;left:${10+Math.random()*80}%;bottom:${Math.random()*60}%;background:${colors[Math.floor(Math.random()*colors.length)]};animation-delay:${Math.random()*2}s`;layer.appendChild(p)}}
function createEmbers(){const layer=document.getElementById('particleLayer');for(let i=0;i<25;i++){const e=document.createElement('div');e.className='ember';const s=2+Math.random()*5;const startY=Math.random()*200;e.style.cssText=`width:${s}px;height:${s}px;left:${Math.random()*100}%;top:${startY}px;background:#4b5563;--start:${startY}px;animation-delay:${1+Math.random()*2}s`;layer.appendChild(e)}}
function closeDest(){document.getElementById('destroyScene').classList.remove('active');document.getElementById('destroyPaper').className='destroy-paper';document.getElementById('paperText').value=''}

let sndCtx=null;const sndNodes={};let masterV=0.5,sndTimer=null,sndEnd=0;
function getSnd(){if(!sndCtx)sndCtx=new(window.AudioContext||window.webkitAudioContext)();if(sndCtx.state==='suspended')sndCtx.resume();return sndCtx}
function makeSndBuf(type){const ctx=getSnd(),sr=ctx.sampleRate,len=sr*4,buf=ctx.createBuffer(2,len,sr),L=buf.getChannelData(0),R=buf.getChannelData(1);if(type==='white')for(let i=0;i<len;i++)L[i]=R[i]=(Math.random()*2-1)*0.5;else if(type==='rain'){let b0=0,b1=0,b2=0,b3=0,b4=0,b5=0,b6=0;for(let i=0;i<len;i++){const w=Math.random()*2-1;b0=0.99886*b0+w*0.0555;b1=0.99332*b1+w*0.0751;b2=0.969*b2+w*0.1539;b3=0.8665*b3+w*0.3105;b4=0.55*b4+w*0.533;b5=-0.7616*b5-w*0.0169;const p=(b0+b1+b2+b3+b4+b5+b6+w*0.5362)*0.06;b6=w*0.116;L[i]=p;R[i]=p;if(Math.random()<0.001)for(let j=0;j<150&&i+j<len;j++){L[i+j]+=0.35*Math.exp(-j/20)*(Math.random()-0.5)}}}else if(type==='wave')for(let i=0;i<len;i++){const phase=((i/sr)%8)/8;const env=phase<0.5?Math.sin(phase*Math.PI):Math.sin(phase*Math.PI)*0.3;L[i]=R[i]=(Math.random()*2-1)*0.3*env}else if(type==='fire')for(let i=0;i<len;i++){let n=(Math.random()*2-1)*0.15;if(Math.random()<0.005)for(let j=0;j<300&&i+j<len;j++)L[i+j]+=0.35*Math.exp(-j/50)*Math.sin(j/sr*300*Math.PI*2);L[i]+=n;R[i]=L[i]*(0.85+Math.random()*0.3)}return buf}
function toggleSnd(el){const t=el.dataset.sound;if(el.classList.contains('active')){el.classList.remove('active');if(sndNodes[t]){sndNodes[t].src.stop();delete sndNodes[t]}}else{el.classList.add('active');const ctx=getSnd(),buf=makeSndBuf(t),src=ctx.createBufferSource(),gain=ctx.createGain();src.buffer=buf;src.loop=true;const slider=el.querySelector('.vol-slider');gain.gain.value=master
V*(slider?slider.value/100:0.7);src.connect(gain);gain.connect(ctx.destination);src.start();sndNodes[t]={src,gain,v:slider?slider.value/100:0.7}}}
function setSndVol(slider){const el=slider.closest('.sound-card'),t=el.dataset.sound;if(sndNodes[t]){sndNodes[t].v=slider.value/100;sndNodes[t].gain.gain.value=masterV*sndNodes[t].v}}
function setMaster(v){masterV=v/100;document.getElementById('masterVal').textContent=v+'%';Object.values(sndNodes).forEach(n=>n.gain.gain.value=masterV*n.v)}
function setTimer(btn,min){document.querySelectorAll('.timer-opt').forEach(b=>b.classList.remove('active'));btn.classList.add('active');if(sndTimer)clearInterval(sndTimer);sndEnd=Date.now()+min*60*1000;updTimer();sndTimer=setInterval(()=>{if(Date.now()>=sndEnd){stopSounds();document.getElementById('timerInfo').textContent='å·²åœæ­¢'}else updTimer()},1000)}
function updTimer(){const left=Math.max(0,sndEnd-Date.now()),m=Math.floor(left/60000),s=Math.floor((left%60000)/1000);document.getElementById('timerInfo').textContent=`${m}:${s.toString().padStart(2,'0')} ååœæ­¢`}
function stopSounds(){Object.keys(sndNodes).forEach(k=>{sndNodes[k].src.stop();delete sndNodes[k]});document.querySelectorAll('.sound-card').forEach(el=>el.classList.remove('active'));if(sndTimer){clearInterval(sndTimer);sndTimer=null}document.getElementById('timerInfo').textContent=''}

let ballInt=null,ballRec=null,ballPress=0;
function setTouch(m){document.querySelectorAll('.touch-opt').forEach(o=>o.classList.remove('active'));document.querySelector(`.touch-opt:nth-child(${m==='ball'?1:m==='bag'?2:m==='sand'?3:4})`).classList.add('active');stopBall();const cv=document.getElementById('touchCanvas'),tip=document.getElementById('touchTip');
if(m==='ball'){cv.innerHTML='<div class="ball-scene"><div class="stress-ball" id="ball"></div><div class="ball-shadow" id="ballShd"></div><div class="ball-hint" id="ballHint">æŒ‰ä½ä¸æ”¾</div></div>';tip.textContent='æŒ‰ä½çƒä½“ï¼Œçœ‹å®ƒè¢«å‹æ‰';initBall()}
else if(m==='bag'){cv.innerHTML='<div class="bag-scene"><div class="bag-ceiling"></div><div class="bag-chain"></div><div class="punching-bag" id="punchBag"><div class="bag-top"></div><div class="bag-body"><div class="bag-highlight"></div></div><div class="bag-bottom"></div></div><div class="combo-display" id="comboDisp">COMBO x5</div><div class="boxer"><div class="boxer-body" id="boxerBody">ğŸ¥Š</div></div><div class="bag-stats"><div class="bag-count" id="punchCount">0</div><div class="bag-label">æ¬¡å‡ºæ‹³</div></div></div>';tip.textContent='ç‚¹å‡»å±å¹•æŒ¥æ‹³ï¼';initBag()}
else if(m==='sand'){cv.innerHTML='<div class="sand-scene"><canvas class="sand-cv" id="sandCv"></canvas><div class="sand-overlay" id="sandOvl"><div class="sand-icon">ğŸ–ï¸</div><div class="sand-text">ç”¨æ‰‹æŒ‡åœ¨æ²™ä¸Šä½œç”»</div></div><button class="sand-clear" onclick="clearSand()">ğŸ”„</button></div>';tip.textContent='ç”»å®Œæ‘‡ä¸€æ‘‡æ¸…ç©º';initSand()}
else{cv.innerHTML='<div class="zen-scene"><canvas class="zen-cv" id="zenCv"></canvas><div class="zen-tabs"><button class="zen-tab active" onclick="setZen(\'spiral\')">èºæ—‹</button><button class="zen-tab" onclick="setZen(\'wave\')">æ³¢æµª</button><button class="zen-tab" onclick="setZen(\'circle\')">åœ†ç¯</button></div><div class="zen-status" id="zenSt">è·Ÿéšå¼•å¯¼çº¿</div></div>';tip.textContent='è·Ÿéšç°è‰²å¼•å¯¼çº¿æç»˜';initZen()}}

function initBall(){const ball=document.getElementById('ball'),shd=document.getElementById('ballShd'),hint=document.getElementById('ballHint');ballPress=0;
function down(e){e.preventDefault();hint.style.opacity='1';if(ballRec){clearInterval(ballRec);ballRec=null}ballInt=setInterval(()=>{if(ballPress<100)ballPress+=3;updBall();if(ballPress%10===0)vibrate(10+ballPress/4)},40)}
function up(){if(ballInt){clearInterval(ballInt);ballInt=null}vibrate([30,20,50]);ballRec=setInterval(()=>{if(ballPress>0){ballPress-=2;if(ballPress<0)ballPress=0;updBall()}else{clearInterval(ballRec);ballRec=null;hint.style.opacity='0.5'}},20)}
function updBall(){const p=ballPress/100;const scX=1-p*0.35;const scY=1-p*0.55;const skew=p*15;ball.style.transform=`scale(${scX},${scY}) skewX(${skew}deg)`;ball.style.borderRadius=`${50-p*15}% ${50-p*15}% ${50+p*10}% ${50+p*10}%`;shd.style.width=(45+p*25)+'%';shd.style.height=(12+p*6)+'px';shd.style.bottom=(40-p*15)+'px';const msgs=['æŒ‰ä½ä¸æ”¾','ç”¨åŠ›...','ç»§ç»­å‹ï¼','å¿«æ‰äº†...','å†ç”¨åŠ›ï¼','ğŸ’¥ çˆ†å‘ï¼'];hint.textContent=msgs[Math.min(Math.floor(ballPress/18),5)]}
ball.onmousedown=ball.ontouchstart=down;ball.onmouseup=ball.onmouseleave=ball.ontouchend=ball.ontouchcancel=up}

let punchCnt=0,combo=0,lastPunch=0;
function initBag(){punchCnt=0;combo=0;const scene=document.querySelector('.bag-scene');scene.onclick=scene.ontouchstart=e=>{e.preventDefault();doPunch()}}
function doPunch(){const bag=document.getElementById('punchBag'),boxer=document.getElementById('boxerBody'),now=Date.now();playPunchSound();vibrate([40,15,60]);punchCnt++;document.getElementById('punchCount').textContent=punchCnt;
const isLeft=punchCnt%2===1;boxer.className='boxer-body '+(isLeft?'punch-left':'punch-right');setTimeout(()=>boxer.className='boxer-body',80);
const swing=isLeft?-18:18;bag.style.transform=`translateX(-50%) rotate(${swing}deg)`;setTimeout(()=>bag.style.transform='translateX(-50%) rotate(0deg)',150);
if(now-lastPunch<600){combo++;if(combo>=3){const cd=document.getElementById('comboDisp');cd.textContent='COMBO x'+combo;cd.classList.add('show');setTimeout(()=>cd.classList.remove('show'),500)}}else{combo=1}lastPunch=now;
const eff=document.createElement('div');eff.className='punch-effect';eff.textContent=['ğŸ’¥','ğŸ’¢','âš¡','ğŸ”¥'][Math.floor(Math.random()*4)];eff.style.cssText=`top:${120+Math.random()*60}px;left:${isLeft?'30%':'60%'}`;document.querySelector('.bag-scene').appendChild(eff);setTimeout(()=>eff.remove(),400)}

function stopBall(){if(ballInt){clearInterval(ballInt);ballInt=null}if(ballRec){clearInterval(ballRec);ballRec=null}}

let sandCtx=null,sandDraw=false,sandLX=0,sandLY=0;
function initSand(){const cv=document.getElementById('sandCv'),ctx=cv.getContext('2d');cv.width=cv.offsetWidth*2;cv.height=cv.offsetHeight*2;ctx.scale(2,2);drawSandBg(ctx,cv.offsetWidth,cv.offsetHeight);sandCtx=ctx;function pos(e){const r=cv.getBoundingClientRect(),t=e.touches?e.touches[0]:e;return{x:t.clientX-r.left,y:t.clientY-r.top}}cv.onmousedown=cv.ontouchstart=e=>{e.preventDefault();sandDraw=true;const p=pos(e);sandLX=p.x;sandLY=p.y;document.getElementById('sandOvl').classList.add('hidden')};cv.onmousemove=cv.ontouchmove=e=>{if(!sandDraw)return;e.preventDefault();const p=pos(e);sandCtx.strokeStyle='#78350f';sandCtx.lineWidth=12+Math.random()*6;sandCtx.lineCap='round';sandCtx.beginPath();sandCtx.moveTo(sandLX,sandLY);sandCtx.lineTo(p.x,p.y);sandCtx.stroke();sandLX=p.x;sandLY=p.y;vibrate(3)};cv.onmouseup=cv.ontouchend=cv.ontouchcancel=()=>sandDraw=false}
function drawSandBg(ctx,w,h){const g=ctx.createLinearGradient(0,0,0,h);g.addColorStop(0,'#d4a574');g.addColorStop(1,'#c49a6c');ctx.fillStyle=g;ctx.fillRect(0,0,w,h);for(let i=0;i<2500;i++){ctx.fillStyle=`rgba(${180+Math.random()*40},${140+Math.random()*30},${90+Math.random()*20},${0.25+Math.random()*0.3})`;ctx.fillRect(Math.random()*w,Math.random()*h,1,1)}}
function clearSand(){vibrate([30,20,30,20,50]);const cv=document.getElementById('sandCv');if(sandCtx){drawSandBg(sandCtx,cv.offsetWidth,cv.offsetHeight);document.getElementById('sandOvl').classList.remove('hidden')}}

let zenCtx=null,zenDraw=false,zenLX=0,zenLY=0,zenPat='spiral',zenStrokes=0;
function initZen(){const cv=document.getElementById('zenCv'),ctx=cv.getContext('2d');cv.width=cv.offsetWidth*2;cv.height=cv.offsetHeight*2;ctx.scale(2,2);ctx.fillStyle='#faf8f5';ctx.fillRect(0,0,cv.offsetWidth,cv.offsetHeight);zenCtx=ctx;zenStrokes=0;drawZenGuide();function pos(e){const r=cv.getBoundingClientRect(),t=e.touches?e.touches[0]:e;return{x:t.clientX-r.left,y:t.clientY-r.top}}cv.onmousedown=cv.ontouchstart=e=>{e.preventDefault();zenDraw=true;const p=pos(e);zenLX=p.x;zenLY=p.y};cv.onmousemove=cv.ontouchmove=e=>{if(!zenDraw)return;e.preventDefault();const p=pos(e);zenCtx.strokeStyle='#1f2937';zenCtx.lineWidth=2;zenCtx.lineCap='round';zenCtx.beginPath();zenCtx.moveTo(zenLX,zenLY);zenCtx.lineTo(p.x,p.y);zenCtx.stroke();zenLX=p.x;zenLY=p.y;zenStrokes++;if(zenStrokes%20===0)vibrate(4);updZen()};cv.onmouseup=cv.ontouchend=cv.ontouchcancel=()=>zenDraw=false}
function setZen(p){zenPat=p;document.querySelectorAll('.zen-tab').forEach(t=>t.classList.remove('active'));event.target.classList.add('active');const cv=document.getElementById('zenCv');zenCtx.fillStyle='#faf8f5';zenCtx.fillRect(0,0,cv.offsetWidth,cv.offsetHeight);zenStrokes=0;drawZenGuide();document.getElementById('zenSt').textContent='è·Ÿéšå¼•å¯¼çº¿'}
function drawZenGuide(){const cv=document.getElementById('zenCv'),w=cv.offsetWidth,h=cv.offsetHeight,cx=w/2,cy=h/2;zenCtx.strokeStyle='rgba(0,0,0,0.08)';zenCtx.lineWidth=1;zenCtx.setLineDash([4,4]);if(zenPat==='spiral'){zenCtx.beginPath();for(let i=0;i<720;i++){const a=i*Math.PI/180,r=10+i*0.14,x=cx+r*Math.cos(a),y=cy+r*Math.sin(a);i===0?zenCtx.moveTo(x,y):zenCtx.lineTo(x,y)}zenCtx.stroke()}else if(zenPat==='wave'){for(let row=0;row<5;row++){zenCtx.beginPath();for(let x=20;x<w-20;x++){const y=55+row*48+Math.sin(x*0.05)*14;x===20?zenCtx.moveTo(x,y):zenCtx.lineTo(x,y)}zenCtx.stroke()}}else{for(let i=1;i<=5;i++){zenCtx.beginPath();zenCtx.arc(cx,cy,i*24,0,Math.PI*2);zenCtx.stroke()}}zenCtx.setLineDash([])}
function updZen(){const msgs=['åˆšå¼€å§‹...','ç»§ç»­...','ä¿æŒä¸“æ³¨...','å¿ƒæµçŠ¶æ€...','ğŸ§˜ å®Œç¾'];document.getElementById('zenSt').textContent=msgs[Math.min(Math.floor(zenStrokes/100),4)]}
</script>
</body>
</html>
