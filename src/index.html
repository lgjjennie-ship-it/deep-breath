<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#1a1a2e">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <link rel="manifest" href="manifest.json">
    <title id="pageTitle">æ·±å‘¼å¸ - 3åˆ†é’Ÿè§£å‹</title>
    <style>
        :root{--bg1:#1a1a2e;--bg2:#16213e;--bg3:#0f3460;--accent:#a29bfe;--accent2:#6c5ce7;--text:#f5f5f5;--text2:#7f8fa6;--text3:#555}
        *{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent;-webkit-user-select:none;user-select:none}
        body{font-family:-apple-system,BlinkMacSystemFont,sans-serif;background:linear-gradient(135deg,var(--bg1),var(--bg2),var(--bg3));min-height:100vh;color:var(--text)}
        .container{max-width:420px;margin:0 auto;padding:20px;min-height:100vh}
        .header{text-align:center;padding:30px 0 20px}
        .header h1{font-size:28px;font-weight:300;letter-spacing:4px;margin-bottom:8px}
        .header p{font-size:14px;color:var(--text2)}
        .mood-section{background:rgba(255,255,255,0.05);border-radius:20px;padding:24px;margin-bottom:24px}
        .mood-title{text-align:center;font-size:16px;margin-bottom:8px;color:var(--accent)}
        .mood-desc{text-align:center;font-size:12px;color:var(--text3);margin-bottom:20px}
        .mood-options{display:flex;flex-wrap:wrap;gap:12px;justify-content:center}
        .mood-btn{background:rgba(255,255,255,0.08);border:1px solid rgba(255,255,255,0.1);border-radius:12px;padding:12px 16px;font-size:14px;color:var(--text);cursor:pointer}
        .mood-btn.selected{background:rgba(162,155,254,0.3);border-color:var(--accent)}
        .recommend-section{display:none;background:rgba(162,155,254,0.1);border-radius:16px;padding:20px;margin-bottom:24px;border:1px solid rgba(162,155,254,0.2)}
        .recommend-section.show{display:block;animation:fadeIn .3s}
        @keyframes fadeIn{from{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}
        .recommend-title{font-size:14px;color:var(--accent);margin-bottom:12px}
        .recommend-btns{display:flex;gap:12px;flex-wrap:wrap}
        .recommend-btn{background:rgba(162,155,254,0.2);border:1px solid var(--accent);border-radius:20px;padding:10px 20px;font-size:14px;color:#fff;cursor:pointer}
        .modules{display:grid;grid-template-columns:repeat(3,1fr);gap:16px}
        .module-card{background:rgba(255,255,255,0.06);border-radius:16px;padding:24px 12px;text-align:center;cursor:pointer}
        .module-icon{font-size:32px;margin-bottom:12px}
        .module-name{font-size:14px;color:#ddd}
        .page{display:none;position:fixed;top:0;left:0;right:0;bottom:0;background:linear-gradient(135deg,var(--bg1),var(--bg2),var(--bg3));z-index:100;overflow-y:auto}
        .page.active{display:flex;flex-direction:column}
        .page-header{display:flex;justify-content:space-between;align-items:center;padding:15px 20px}
        .back-btn{background:rgba(255,255,255,0.1);border:none;border-radius:50%;width:40px;height:40px;color:var(--text);font-size:20px;cursor:pointer}
        .page-title{font-size:18px}
        .page-content{flex:1;display:flex;flex-direction:column;align-items:center;padding:20px;overflow-y:auto}
        .science-card{background:rgba(162,155,254,0.1);border-radius:16px;padding:16px 20px;margin-bottom:30px;width:100%;max-width:360px;border-left:3px solid var(--accent)}
        .science-card h4{font-size:13px;color:var(--accent);margin-bottom:8px}
        .science-card p{font-size:12px;color:#9f9f9f;line-height:1.6}
        .science-card .source{font-size:11px;color:var(--text3);margin-top:8px;font-style:italic}
        .breath-circle-container{width:200px;height:200px;margin-bottom:30px}
        .breath-circle{width:100%;height:100%;border-radius:50%;background:radial-gradient(circle,rgba(162,155,254,0.4),rgba(162,155,254,0.1) 70%);box-shadow:0 0 60px rgba(162,155,254,0.3);display:flex;align-items:center;justify-content:center;transition:transform 4s ease-in-out,box-shadow 4s}
        .breath-circle.inhale{transform:scale(1.3);box-shadow:0 0 80px rgba(162,155,254,0.5)}
        .breath-circle.exhale{transform:scale(0.8);box-shadow:0 0 40px rgba(162,155,254,0.2)}
        .breath-timer{font-size:48px;font-weight:200}
        .breath-status{margin-top:20px;font-size:20px;color:var(--accent)}
        .breath-progress{margin-top:8px;font-size:14px;color:var(--text3)}
        .start-btn{margin-top:30px;background:linear-gradient(135deg,var(--accent),var(--accent2));border:none;border-radius:30px;padding:16px 48px;font-size:16px;color:#fff;cursor:pointer}
        .breath-modes{margin-top:20px;display:flex;gap:10px}
        .breath-mode{background:rgba(255,255,255,0.1);border:none;border-radius:20px;padding:10px 16px;font-size:12px;color:var(--text2);cursor:pointer}
        .breath-mode.active{background:rgba(162,155,254,0.3);color:var(--text)}
        .daze-container{position:fixed;top:0;left:0;right:0;bottom:0;display:flex;flex-direction:column;align-items:center;justify-content:center}
        .daze-canvas{position:absolute;top:0;left:0;width:100%;height:100%}
        .daze-timer{position:absolute;bottom:100px;font-size:48px;font-weight:200;color:rgba(255,255,255,0.3);z-index:1}
        .daze-hint{position:absolute;bottom:60px;font-size:12px;color:rgba(255,255,255,0.2);z-index:1}
        .daze-exit{position:absolute;top:20px;right:20px;background:rgba(255,255,255,0.1);border:none;border-radius:50%;width:40px;height:40px;color:rgba(255,255,255,0.5);font-size:16px;cursor:pointer;z-index:2}
        .bubble-container{position:absolute;top:70px;left:0;right:0;bottom:120px;overflow:hidden}
        .bubble{position:absolute;border-radius:50%;background:radial-gradient(circle at 30% 30%,rgba(255,255,255,0.9),rgba(162,155,254,0.5) 60%,rgba(108,92,231,0.3));cursor:pointer;animation:float 3s ease-in-out infinite;box-shadow:inset 0 -8px 25px rgba(162,155,254,0.4)}
        .bubble::before{content:'';position:absolute;top:12%;left:18%;width:35%;height:25%;background:linear-gradient(135deg,rgba(255,255,255,0.9),rgba(255,255,255,0.2));border-radius:50%}
        @keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-15px)}}
        .bubble.pop{animation:pop .15s ease-out forwards;pointer-events:none}
        @keyframes pop{0%{transform:scale(1);opacity:1}100%{transform:scale(1.5);opacity:0}}
        .bubble-footer{position:absolute;bottom:0;left:0;right:0;padding:15px 20px;background:rgba(26,26,46,0.95)}
        .bubble-score{text-align:center;font-size:16px;color:var(--accent);margin-bottom:10px}
        .bubble-tip{text-align:center;font-size:11px;color:var(--text3);line-height:1.5}
        .pop-text{position:absolute;font-size:24px;pointer-events:none;animation:popText .5s ease-out forwards;z-index:10}
        @keyframes popText{0%{transform:scale(0.5);opacity:1}100%{transform:scale(1.2) translateY(-30px);opacity:0}}
        .tear-container{width:100%;display:flex;flex-direction:column;align-items:center}
        .tear-paper{width:90%;max-width:340px;min-height:200px;background:linear-gradient(180deg,#fff9e6,#fff5d6);border-radius:4px;padding:20px;box-shadow:0 4px 20px rgba(0,0,0,0.3);position:relative}
        .tear-paper textarea{width:100%;height:150px;background:transparent;border:none;outline:none;font-size:16px;color:#333;resize:none;line-height:1.8}
        .tear-paper-lines{position:absolute;top:60px;left:20px;right:20px;bottom:20px;background:repeating-linear-gradient(transparent,transparent 27px,#e0d5c0 28px);pointer-events:none}
        .tear-hint{margin-top:30px;font-size:14px;color:var(--text2)}
        .tear-btn{margin-top:20px;background:linear-gradient(135deg,#e74c3c,#c0392b);border:none;border-radius:25px;padding:14px 40px;font-size:16px;color:#fff;cursor:pointer}
        .tear-pieces{position:fixed;top:0;left:0;right:0;bottom:0;pointer-events:none;z-index:50}
        .tear-piece{position:absolute;background:#fff9e6;animation:tearFall 1s ease-out forwards}
        @keyframes tearFall{0%{opacity:1;transform:translateY(0) rotate(0)}100%{opacity:0;transform:translateY(100vh) rotate(720deg)}}
        .sound-content{width:100%;max-width:380px}
        .sound-item{background:rgba(255,255,255,0.06);border-radius:16px;padding:16px 20px;margin-bottom:12px;border:1px solid transparent}
        .sound-item.active{background:rgba(255,255,255,0.1);border-color:var(--accent)}
        .sound-row{display:flex;align-items:center;justify-content:space-between;cursor:pointer}
        .sound-info{display:flex;align-items:center;gap:14px}
        .sound-icon{font-size:26px}
        .sound-name{font-size:15px}
        .sound-desc{font-size:11px;color:var(--text2);margin-top:2px}
        .sound-toggle{width:50px;height:28px;background:rgba(255,255,255,0.1);border-radius:14px;position:relative}
        .sound-toggle::after{content:'';position:absolute;top:4px;left:4px;width:20px;height:20px;background:#fff;border-radius:50%;transition:left .3s}
        .sound-item.active .sound-toggle{background:var(--accent)}
        .sound-item.active .sound-toggle::after{left:26px}
        .sound-slider-wrap{margin-top:12px;display:none}
        .sound-item.active .sound-slider-wrap{display:block}
        .sound-slider{width:100%;height:4px;-webkit-appearance:none;background:rgba(255,255,255,0.1);border-radius:2px}
        .sound-slider::-webkit-slider-thumb{-webkit-appearance:none;width:16px;height:16px;background:var(--accent);border-radius:50%}
        .master-volume{margin-top:20px;padding:16px;background:rgba(255,255,255,0.05);border-radius:16px}
        .master-label{font-size:14px;color:var(--text2);margin-bottom:12px;display:flex;justify-content:space-between}
        .timer-section{margin-top:20px;text-align:center}
        .timer-btns{display:flex;gap:10px;justify-content:center}
        .timer-btn{background:rgba(255,255,255,0.08);border:1px solid rgba(255,255,255,0.1);border-radius:20px;padding:8px 16px;font-size:13px;color:var(--text);cursor:pointer}
        .timer-btn.active{background:rgba(162,155,254,0.3);border-color:var(--accent)}
        .timer-display{margin-top:12px;font-size:13px;color:var(--text3)}
        
        /* è§¦æ„Ÿæ¨¡å—å¢å¼º */
        .touch-tabs{display:flex;gap:8px;margin-bottom:20px;flex-wrap:wrap;justify-content:center}
        .touch-tab{background:rgba(255,255,255,0.08);border:1px solid rgba(255,255,255,0.1);border-radius:20px;padding:10px 16px;font-size:13px;color:var(--text);cursor:pointer}
        .touch-tab.active{background:rgba(162,155,254,0.3);border-color:var(--accent)}
        .touch-area{width:100%;max-width:340px;height:340px;border-radius:20px;overflow:hidden;position:relative;background:#1a1a2e}
        .touch-hint{text-align:center;font-size:12px;color:var(--text3);margin-top:16px;line-height:1.6}
        
        /* è§£å‹çƒå¢å¼º */
        .ball-container{width:100%;height:100%;display:flex;align-items:center;justify-content:center;background:radial-gradient(circle at 50% 60%,#2d1b4e,#1a1a2e);position:relative}
        .ball-wrapper{position:relative;width:180px;height:180px}
        .ball{width:100%;height:100%;border-radius:50%;background:radial-gradient(circle at 30% 25%,#ffb8d0,#ff6b9d 30%,#e91e8c 60%,#b8156b 85%);box-shadow:0 30px 60px rgba(0,0,0,0.5),inset 0 -20px 40px rgba(0,0,0,0.3),inset 0 10px 30px rgba(255,255,255,0.2);cursor:pointer;transition:none;transform-origin:center center}
        .ball-shadow{position:absolute;bottom:-30px;left:50%;transform:translateX(-50%);width:140px;height:20px;background:radial-gradient(ellipse,rgba(0,0,0,0.4),transparent 70%);border-radius:50%;transition:all 0.3s}
        .ball-pressure{position:absolute;bottom:20px;left:50%;transform:translateX(-50%);font-size:14px;color:var(--accent);opacity:0;transition:opacity 0.3s}
        
        /* æ²™ç›˜å¢å¼º */
        .sand-container{width:100%;height:100%;position:relative;overflow:hidden}
        .sand-canvas{width:100%;height:100%;touch-action:none;cursor:crosshair}
        .sand-guide{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);text-align:center;color:rgba(255,255,255,0.3);pointer-events:none;transition:opacity 0.5s}
        .sand-guide.hidden{opacity:0}
        .sand-guide-icon{font-size:48px;margin-bottom:12px}
        .sand-guide-text{font-size:14px;line-height:1.6}
        .sand-tools{position:absolute;top:10px;right:10px;display:flex;gap:8px}
        .sand-btn{background:rgba(255,255,255,0.15);border:none;border-radius:50%;width:40px;height:40px;font-size:18px;cursor:pointer;color:#fff}
        .sand-quote{position:absolute;bottom:15px;left:15px;right:15px;text-align:center;font-size:11px;color:rgba(255,255,255,0.25);font-style:italic}
        
        /* ç¦…ç»•ç”» */
        .zen-container{width:100%;height:100%;position:relative}
        .zen-canvas{width:100%;height:100%;touch-action:none;background:#f5f0e6;border-radius:16px}
        .zen-guide{position:absolute;top:0;left:0;width:100%;height:100%;pointer-events:none;opacity:0.15}
        .zen-progress{position:absolute;bottom:15px;left:50%;transform:translateX(-50%);font-size:12px;color:var(--text3)}
        .zen-pattern-select{position:absolute;top:10px;left:10px;right:10px;display:flex;gap:8px;justify-content:center}
        .zen-pattern-btn{background:rgba(0,0,0,0.1);border:none;border-radius:8px;padding:6px 12px;font-size:11px;color:#666;cursor:pointer}
        .zen-pattern-btn.active{background:var(--accent);color:#fff}
        
        .footer{text-align:center;padding:30px 0;font-size:12px;color:var(--text3)}
    </style>
</head>
<body>
    <div class="container" id="home">
        <div class="header"><h1>æ·±å‘¼å¸</h1><p>åŸºäºè„‘ç§‘å­¦çš„3åˆ†é’Ÿè§£å‹</p></div>
        <div class="mood-section">
            <div class="mood-title">ç°åœ¨æ„Ÿè§‰æ€ä¹ˆæ ·ï¼Ÿ</div>
            <div class="mood-desc">é€‰æ‹©åä¸ºä½ æ¨èæœ€é€‚åˆçš„è§£å‹æ–¹å¼</div>
            <div class="mood-options">
                <button class="mood-btn" onclick="selectMood(this,'anxious')">ğŸ˜° å¾ˆç„¦è™‘</button>
                <button class="mood-btn" onclick="selectMood(this,'sad')">ğŸ˜” æœ‰ç‚¹ä¸§</button>
                <button class="mood-btn" onclick="selectMood(this,'angry')">ğŸ˜¤ çƒ¦èº</button>
                <button class="mood-btn" onclick="selectMood(this,'tired')">ğŸ¥± ç–²æƒ«</button>
                <button class="mood-btn" onclick="selectMood(this,'unclear')">ğŸ˜¶ è¯´ä¸æ¸…</button>
            </div>
        </div>
        <div class="recommend-section" id="recommendSection">
            <div class="recommend-title">ğŸ’¡ ä¸ºä½ æ¨è</div>
            <div class="recommend-btns" id="recommendBtns"></div>
        </div>
        <div class="modules">
            <div class="module-card" onclick="openPage('breath')"><div class="module-icon">ğŸ«</div><div class="module-name">å‘¼å¸</div></div>
            <div class="module-card" onclick="openPage('daze')"><div class="module-icon">ğŸŒ€</div><div class="module-name">å‘å‘†</div></div>
            <div class="module-card" onclick="openPage('bubble')"><div class="module-icon">ğŸ«§</div><div class="module-name">æ³¡æ³¡</div></div>
            <div class="module-card" onclick="openPage('tear')"><div class="module-icon">ğŸ“„</div><div class="module-name">æ’•çº¸</div></div>
            <div class="module-card" onclick="openPage('sound')"><div class="module-icon">ğŸµ</div><div class="module-name">å£°éŸ³</div></div>
            <div class="module-card" onclick="openPage('touch')"><div class="module-icon">ğŸ–ï¸</div><div class="module-name">è§¦æ„Ÿ</div></div>
        </div>
        <div class="footer">æ¯ä¸ªåŠŸèƒ½éƒ½æœ‰ç§‘å­¦ä¾æ® Â· æ”¯æŒç¦»çº¿ä½¿ç”¨</div>
    </div>

    <!-- å‘¼å¸ -->
    <div class="page" id="breath-page">
        <div class="page-header"><button class="back-btn" onclick="closePage()">â†</button><div class="page-title">ğŸ« ç§‘å­¦å‘¼å¸</div><div style="width:40px"></div></div>
        <div class="page-content">
            <div class="science-card"><h4>ğŸ”¬ ç§‘å­¦åŸç†</h4><p>4-7-8å‘¼å¸æ³•é€šè¿‡å»¶é•¿å‘¼æ°”æ—¶é—´ï¼Œæ¿€æ´»è¿·èµ°ç¥ç»ï¼Œè§¦å‘å‰¯äº¤æ„Ÿç¥ç»çš„"ä¼‘æ¯-æ¶ˆåŒ–"ååº”ï¼Œ60ç§’å†…å¯æ˜¾è‘—é™ä½å¿ƒç‡å’Œè¡€å‹ã€‚</p><div class="source">â€” Dr. Andrew Weil, Harvard Medical School</div></div>
            <div class="breath-circle-container"><div class="breath-circle" id="breathCircle"><div class="breath-timer" id="breathTimer">4</div></div></div>
            <div class="breath-status" id="breathStatus">å‡†å¤‡å¥½äº†å—ï¼Ÿ</div>
            <div class="breath-progress" id="breathProgress"></div>
            <button class="start-btn" id="breathBtn" onclick="toggleBreath()">å¼€å§‹å‘¼å¸</button>
            <div class="breath-modes"><button class="breath-mode active" data-mode="478" onclick="setBreathMode(this)">4-7-8</button><button class="breath-mode" data-mode="box" onclick="setBreathMode(this)">æ–¹å—å‘¼å¸</button></div>
        </div>
    </div>

    <!-- å‘å‘† -->
    <div class="page" id="daze-page">
        <div class="daze-container">
            <button class="daze-exit" onclick="closePage()">âœ•</button>
            <canvas class="daze-canvas" id="dazeCanvas"></canvas>
            <div class="daze-timer" id="dazeTimer">3:00</div>
            <div class="daze-hint">ä»€ä¹ˆéƒ½ä¸ç”¨åšï¼Œè½»ç‚¹å±å¹•é€€å‡º</div>
        </div>
    </div>

    <!-- æ³¡æ³¡ -->
    <div class="page" id="bubble-page">
        <div class="page-header"><button class="back-btn" onclick="closePage()">â†</button><div class="page-title">ğŸ«§ ææ³¡æ³¡</div><div style="width:40px"></div></div>
        <div class="bubble-container" id="bubbleContainer"></div>
        <div class="bubble-footer">
            <div class="bubble-score">å·²æçˆ† <span id="bubbleCount">0</span> ä¸ª ğŸ‰</div>
            <div class="bubble-tip">ğŸ”¬ å…·èº«è®¤çŸ¥ï¼šæ¨¡æ‹Ÿç ´ååŠ¨ä½œå¯è±¡å¾æ€§é‡Šæ”¾å‹åŠ› â€” Niedenthal, Science 2007</div>
        </div>
    </div>

    <!-- æ’•çº¸ -->
    <div class="page" id="tear-page">
        <div class="page-header"><button class="back-btn" onclick="closePage()">â†</button><div class="page-title">ğŸ“„ æ’•æ‰çƒ¦æ¼</div><div style="width:40px"></div></div>
        <div class="page-content">
            <div class="science-card"><h4>ğŸ”¬ ç§‘å­¦åŸç†</h4><p>è¡¨è¾¾æ€§å†™ä½œå¯æ˜¾è‘—é™ä½ç„¦è™‘ã€‚å†™ä¸‹è´Ÿé¢æƒ…ç»ªç„¶å"é”€æ¯"ï¼Œè±¡å¾æ€§åœ°å‘Šåˆ«å®ƒä»¬ã€‚</p><div class="source">â€” Pennebaker, Psychological Science 1997</div></div>
            <div class="tear-container">
                <div class="tear-paper" id="tearPaper"><textarea id="tearText" placeholder="å†™ä¸‹è®©ä½ çƒ¦æ¼çš„äº‹..."></textarea><div class="tear-paper-lines"></div></div>
                <div class="tear-hint">å†™å®Œåç‚¹å‡»æ’•æ‰ï¼Œè±¡å¾æ€§å‘Šåˆ«çƒ¦æ¼</div>
                <button class="tear-btn" onclick="tearPaper()">ğŸ”¥ æ’•æ‰å®ƒï¼</button>
            </div>
        </div>
        <div class="tear-pieces" id="tearPieces"></div>
    </div>

    <!-- å£°éŸ³ -->
    <div class="page" id="sound-page">
        <div class="page-header"><button class="back-btn" onclick="closePage()">â†</button><div class="page-title">ğŸµ å£°éŸ³ç–—æ„ˆ</div><div style="width:40px"></div></div>
        <div class="page-content">
            <div class="science-card"><h4>ğŸ”¬ ç§‘å­¦åŸç†</h4><p>ç‰¹å®šé¢‘ç‡å£°éŸ³å½±å“è„‘ç”µæ³¢ã€‚ç²‰çº¢å™ªéŸ³å¢å¼ºæ·±åº¦ç¡çœ ï¼Œè‡ªç„¶éŸ³å”¤èµ·è¿›åŒ–ä¸Šçš„å®‰å…¨æ„Ÿï¼Œé™ä½çš®è´¨é†‡æ°´å¹³ã€‚</p><div class="source">â€” Journal of Theoretical Biology, 2012</div></div>
            <div class="sound-content">
                <div class="sound-item" data-sound="rain"><div class="sound-row" onclick="toggleSound(this.parentElement)"><div class="sound-info"><span class="sound-icon">ğŸŒ§ï¸</span><div><div class="sound-name">é›¨å£°</div><div class="sound-desc">æ·…æ·…æ²¥æ²¥çš„å°é›¨</div></div></div><div class="sound-toggle"></div></div><div class="sound-slider-wrap"><input type="range" class="sound-slider" min="0" max="100" value="70" onchange="setSoundVol(this)"></div></div>
                <div class="sound-item" data-sound="wave"><div class="sound-row" onclick="toggleSound(this.parentElement)"><div class="sound-info"><span class="sound-icon">ğŸŒŠ</span><div><div class="sound-name">æµ·æµª</div><div class="sound-desc">æœ‰èŠ‚å¥çš„æ½®èµ·æ½®è½</div></div></div><div class="sound-toggle"></div></div><div class="sound-slider-wrap"><input type="range" class="sound-slider" min="0" max="100" value="70" onchange="setSoundVol(this)"></div></div>
                <div class="sound-item" data-sound="fire"><div class="sound-row" onclick="toggleSound(this.parentElement)"><div class="sound-info"><span class="sound-icon">ğŸ”¥</span><div><div class="sound-name">ç¯ç«</div><div class="sound-desc">å™¼å•ªä½œå“çš„ç«ç„°</div></div></div><div class="sound-toggle"></div></div><div class="sound-slider-wrap"><input type="range" class="sound-slider" min="0" max="100" value="70" onchange="setSoundVol(this)"></div></div>
                <div class="sound-item" data-sound="white"><div class="sound-row" onclick="toggleSound(this.parentElement)"><div class="sound-info"><span class="sound-icon">ğŸ“»</span><div><div class="sound-name">ç™½å™ªéŸ³</div><div class="sound-desc">å‡åŒ€çš„å˜¶å˜¶å£°</div></div></div><div class="sound-toggle"></div></div><div class="sound-slider-wrap"><input type="range" class="sound-slider" min="0" max="100" value="70" onchange="setSoundVol(this)"></div></div>
                <div class="sound-item" data-sound="pink"><div class="sound-row" onclick="toggleSound(this.parentElement)"><div class="sound-info"><span class="sound-icon">ğŸ€</span><div><div class="sound-name">ç²‰çº¢å™ªéŸ³</div><div class="sound-desc">æ¯”ç™½å™ªéŸ³æ›´æŸ”å’Œ</div></div></div><div class="sound-toggle"></div></div><div class="sound-slider-wrap"><input type="range" class="sound-slider" min="0" max="100" value="70" onchange="setSoundVol(this)"></div></div>
                <div class="master-volume"><div class="master-label"><span>æ€»éŸ³é‡</span><span id="masterVolValue">50%</span></div><input type="range" class="sound-slider" id="masterVolume" min="0" max="100" value="50" oninput="setMasterVol(this.value)"></div>
                <div class="timer-section"><div class="timer-btns"><button class="timer-btn" onclick="setSoundTimer(this,15)">15åˆ†é’Ÿ</button><button class="timer-btn" onclick="setSoundTimer(this,30)">30åˆ†é’Ÿ</button><button class="timer-btn" onclick="setSoundTimer(this,60)">60åˆ†é’Ÿ</button></div><div class="timer-display" id="timerDisplay"></div></div>
            </div>
        </div>
    </div>

    <!-- è§¦æ„Ÿ -->
    <div class="page" id="touch-page">
        <div class="page-header"><button class="back-btn" onclick="closePage()">â†</button><div class="page-title">ğŸ–ï¸ è§¦æ„Ÿè§£å‹</div><div style="width:40px"></div></div>
        <div class="page-content">
            <div class="science-card"><h4>ğŸ”¬ ç§‘å­¦åŸç†</h4><p>é‡å¤æ€§æ‰‹éƒ¨åŠ¨ä½œæ¿€æ´»"ç¨‹åºæ€§è®°å¿†"ç³»ç»Ÿï¼Œç»•è¿‡è´Ÿè´£ç„¦è™‘çš„å‰é¢å¶çš®å±‚ï¼Œäº§ç”Ÿç±»ä¼¼å†¥æƒ³çš„å¿ƒæµçŠ¶æ€ã€‚</p><div class="source">â€” Csikszentmihalyi, Flow 1990</div></div>
            <div class="touch-tabs">
                <button class="touch-tab active" onclick="switchTouch('ball')">ğŸ”® è§£å‹çƒ</button>
                <button class="touch-tab" onclick="switchTouch('sand')">ğŸ–ï¸ ç¦…æ„æ²™ç›˜</button>
                <button class="touch-tab" onclick="switchTouch('zen')">ğŸŒ€ ç¦…ç»•ç”»</button>
            </div>
            <div class="touch-area" id="touchArea"></div>
            <div class="touch-hint" id="touchHint">æŒ‰ä½çƒä½“ï¼Œæ„Ÿå—å®ƒåœ¨æŒ‡å°–å˜å½¢</div>
        </div>
    </div>

<script>
const titles={home:'æ·±å‘¼å¸ - 3åˆ†é’Ÿè§£å‹',breath:'ç§‘å­¦å‘¼å¸ - æ·±å‘¼å¸',daze:'å‘å‘†æ¨¡å¼ - æ·±å‘¼å¸',bubble:'ææ³¡æ³¡ - æ·±å‘¼å¸',tear:'æ’•çº¸è§£å‹ - æ·±å‘¼å¸',sound:'å£°éŸ³ç–—æ„ˆ - æ·±å‘¼å¸',touch:'è§¦æ„Ÿè§£å‹ - æ·±å‘¼å¸'};
const moodRec={anxious:[{n:'ğŸ« å‘¼å¸',p:'breath'},{n:'ğŸ“» ç™½å™ªéŸ³',p:'sound'}],sad:[{n:'ğŸŒ§ï¸ é›¨å£°',p:'sound'},{n:'ğŸŒ€ å‘å‘†',p:'daze'}],angry:[{n:'ğŸ«§ æ³¡æ³¡',p:'bubble'},{n:'ğŸ“„ æ’•çº¸',p:'tear'}],tired:[{n:'ğŸ”¥ ç¯ç«',p:'sound'},{n:'ğŸŒ€ å‘å‘†',p:'daze'}],unclear:[{n:'ğŸ« å‘¼å¸',p:'breath'},{n:'ğŸ–ï¸ è§¦æ„Ÿ',p:'touch'}]};
function selectMood(btn,mood){document.querySelectorAll('.mood-btn').forEach(b=>b.classList.remove('selected'));btn.classList.add('selected');vibrate(30);const s=document.getElementById('recommendSection'),c=document.getElementById('recommendBtns');c.innerHTML=moodRec[mood].map(r=>`<button class="recommend-btn" onclick="openPage('${r.p}')">${r.n}</button>`).join('');s.classList.add('show');setTimeout(()=>s.scrollIntoView({behavior:'smooth',block:'center'}),100)}
function openPage(p){document.getElementById(p+'-page').classList.add('active');document.getElementById('home').style.display='none';document.getElementById('pageTitle').textContent=titles[p];if(p==='bubble')initBubbles();if(p==='daze')initDaze();if(p==='touch')switchTouch('ball');vibrate(30)}
function closePage(){document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));document.getElementById('home').style.display='block';document.getElementById('pageTitle').textContent=titles.home;if(breathInterval)stopBreath();if(dazeInterval)stopDaze();stopAllSounds();stopBallVibration()}
function vibrate(p){if(navigator.vibrate)navigator.vibrate(p)}

// å‘¼å¸
let breathInterval=null,breathPhase=0,breathCount=0,breathTimer=0;
let breathCfg={inhale:4,hold:7,exhale:8,rounds:4};
function setBreathMode(btn){document.querySelectorAll('.breath-mode').forEach(b=>b.classList.remove('active'));btn.classList.add('active');const m=btn.dataset.mode;if(m==='478')breathCfg={inhale:4,hold:7,exhale:8,rounds:4};else breathCfg={inhale:4,hold:4,exhale:4,hold2:4,rounds:4};document.getElementById('breathTimer').textContent=breathCfg.inhale}
function toggleBreath(){breathInterval?stopBreath():startBreath()}
function startBreath(){breathPhase=0;breathCount=0;breathTimer=breathCfg.inhale;document.getElementById('breathBtn').textContent='åœæ­¢';document.getElementById('breathCircle').className='breath-circle inhale';updateBreathUI();breathInterval=setInterval(()=>{breathTimer--;if(breathTimer<=0){breathPhase++;const maxPhase=breathCfg.hold2?3:2;if(breathPhase>maxPhase){breathPhase=0;breathCount++;if(breathCount>=breathCfg.rounds){completeBreath();return}}switch(breathPhase){case 0:breathTimer=breathCfg.inhale;document.getElementById('breathCircle').className='breath-circle inhale';break;case 1:breathTimer=breathCfg.hold;document.getElementById('breathCircle').className='breath-circle';break;case 2:breathTimer=breathCfg.exhale;document.getElementById('breathCircle').className='breath-circle exhale';break;case 3:breathTimer=breathCfg.hold2;document.getElementById('breathCircle').className='breath-circle';break}vibrate(50)}updateBreathUI()},1000)}
function updateBreathUI(){document.getElementById('breathTimer').textContent=breathTimer;const labels=breathCfg.hold2?['å¸æ°”...','å±ä½...','å‘¼æ°”...','å±ä½...']:['å¸æ°”...','å±ä½...','å‘¼æ°”...'];document.getElementById('breathStatus').textContent=labels[breathPhase];document.getElementById('breathProgress').textContent=`ç¬¬ ${breathCount+1}/${breathCfg.rounds} è½®`}
function stopBreath(){clearInterval(breathInterval);breathInterval=null;document.getElementById('breathBtn').textContent='å¼€å§‹å‘¼å¸';document.getElementById('breathStatus').textContent='å‡†å¤‡å¥½äº†å—ï¼Ÿ';document.getElementById('breathProgress').textContent='';document.getElementById('breathCircle').className='breath-circle';document.getElementById('breathTimer').textContent=breathCfg.inhale}
function completeBreath(){stopBreath();document.getElementById('breathStatus').textContent='âœ¨ å®Œæˆï¼æ„Ÿè§‰å¥½ç‚¹äº†å—ï¼Ÿ';vibrate([100,50,100])}

// å‘å‘†
let dazeInterval=null,dazeTime=180;
function initDaze(){const c=document.getElementById('dazeCanvas'),ctx=c.getContext('2d');c.width=window.innerWidth;c.height=window.innerHeight;dazeTime=180;updateDazeTimer();const blobs=[];for(let i=0;i<5;i++)blobs.push({x:Math.random()*c.width,y:Math.random()*c.height,r:80+Math.random()*60,dx:(Math.random()-0.5)*0.5,dy:(Math.random()-0.5)*0.5,hue:240+Math.random()*60});function draw(){ctx.fillStyle='rgba(26,26,46,0.03)';ctx.fillRect(0,0,c.width,c.height);blobs.forEach(b=>{b.x+=b.dx;b.y+=b.dy;if(b.x<0||b.x>c.width)b.dx*=-1;if(b.y<0||b.y>c.height)b.dy*=-1;const g=ctx.createRadialGradient(b.x,b.y,0,b.x,b.y,b.r);g.addColorStop(0,`hsla(${b.hue},60%,50%,0.3)`);g.addColorStop(1,`hsla(${b.hue},60%,30%,0)`);ctx.fillStyle=g;ctx.beginPath();ctx.arc(b.x,b.y,b.r,0,Math.PI*2);ctx.fill()});requestAnimationFrame(draw)}draw();dazeInterval=setInterval(()=>{dazeTime--;updateDazeTimer();if(dazeTime<=0)closePage()},1000)}
function updateDazeTimer(){const m=Math.floor(dazeTime/60),s=dazeTime%60;document.getElementById('dazeTimer').textContent=`${m}:${s.toString().padStart(2,'0')}`}
function stopDaze(){if(dazeInterval){clearInterval(dazeInterval);dazeInterval=null}}

// æ³¡æ³¡
let bubbleCount=0,popCtx=null;
function initBubbles(){const c=document.getElementById('bubbleContainer');c.innerHTML='';bubbleCount=0;document.getElementById('bubbleCount').textContent='0';for(let i=0;i<12;i++)createBubble();if(!popCtx)popCtx=new(window.AudioContext||window.webkitAudioContext)()}
function createBubble(){const c=document.getElementById('bubbleContainer'),b=document.createElement('div');b.className='bubble';const s=50+Math.random()*45;b.style.width=s+'px';b.style.height=s+'px';b.style.left=(10+Math.random()*(c.offsetWidth-s-20))+'px';b.style.top=(10+Math.random()*(c.offsetHeight-s-20))+'px';b.style.animationDelay=Math.random()*2+'s';b.ontouchstart=b.onclick=function(e){e.preventDefault();popBubble(this)};c.appendChild(b)}
function playPopSound(){if(!popCtx||popCtx.state==='suspended')popCtx?.resume();const o=popCtx.createOscillator(),g=popCtx.createGain();o.type='sine';o.frequency.setValueAtTime(800+Math.random()*600,popCtx.currentTime);o.frequency.exponentialRampToValueAtTime(200,popCtx.currentTime+0.08);g.gain.setValueAtTime(0.25,popCtx.currentTime);g.gain.exponentialRampToValueAtTime(0.01,popCtx.currentTime+0.08);o.connect(g);g.connect(popCtx.destination);o.start();o.stop(popCtx.currentTime+0.08);const n=popCtx.createBufferSource(),nb=popCtx.createBuffer(1,popCtx.sampleRate*0.06,popCtx.sampleRate),nd=nb.getChannelData(0);for(let i=0;i<nb.length;i++)nd[i]=(Math.random()*2-1)*Math.exp(-i/(nb.length*0.15));n.buffer=nb;const ng=popCtx.createGain();ng.gain.value=0.2;n.connect(ng);ng.connect(popCtx.destination);n.start()}
function popBubble(b){if(b.classList.contains('pop'))return;playPopSound();vibrate([20,15,30]);const r=b.getBoundingClientRect();showPopFx(r.left+r.width/2,r.top+r.height/2);b.classList.add('pop');bubbleCount++;document.getElementById('bubbleCount').textContent=bubbleCount;setTimeout(()=>{b.remove();createBubble();if(Math.random()>0.5)createBubble()},150)}
function showPopFx(x,y){const e=['ğŸ’¥','âœ¨','ğŸ’«','â­'][Math.floor(Math.random()*4)],el=document.createElement('div');el.className='pop-text';el.textContent=e;el.style.left=x+'px';el.style.top=y+'px';document.getElementById('bubble-page').appendChild(el);setTimeout(()=>el.remove(),500)}

// æ’•çº¸
function tearPaper(){const paper=document.getElementById('tearPaper'),pieces=document.getElementById('tearPieces'),text=document.getElementById('tearText').value;if(!text.trim()){vibrate(100);return}vibrate([50,30,50,30,100]);paper.style.transition='transform 0.3s,opacity 0.3s';paper.style.transform='scale(0.9)';paper.style.opacity='0.5';for(let i=0;i<20;i++){const p=document.createElement('div');p.className='tear-piece';p.style.width=(20+Math.random()*40)+'px';p.style.height=(30+Math.random()*50)+'px';p.style.left=(Math.random()*100)+'%';p.style.top='40%';p.style.animationDelay=(Math.random()*0.3)+'s';pieces.appendChild(p)}playTearSound();setTimeout(()=>{pieces.innerHTML='';paper.style.transform='';paper.style.opacity='';document.getElementById('tearText').value=''},1200)}
function playTearSound(){if(!popCtx)popCtx=new(window.AudioContext||window.webkitAudioContext)();if(popCtx.state==='suspended')popCtx.resume();const n=popCtx.createBufferSource(),buf=popCtx.createBuffer(1,popCtx.sampleRate*0.5,popCtx.sampleRate),d=buf.getChannelData(0);for(let i=0;i<buf.length;i++)d[i]=(Math.random()*2-1)*Math.exp(-i/(buf.length*0.3))*(0.5+Math.random()*0.5);n.buffer=buf;const f=popCtx.createBiquadFilter();f.type='highpass';f.frequency.value=1000;const g=popCtx.createGain();g.gain.value=0.3;n.connect(f);f.connect(g);g.connect(popCtx.destination);n.start()}

// å£°éŸ³
let audioCtx=null;const activeNodes={};let masterVol=0.5,soundTimer=null,soundTimerEnd=0;
function getCtx(){if(!audioCtx)audioCtx=new(window.AudioContext||window.webkitAudioContext)();if(audioCtx.state==='suspended')audioCtx.resume();return audioCtx}
function createSoundBuffer(type){const ctx=getCtx(),sr=ctx.sampleRate,len=sr*4,buf=ctx.createBuffer(2,len,sr),L=buf.getChannelData(0),R=buf.getChannelData(1);
if(type==='white'){for(let i=0;i<len;i++)L[i]=R[i]=(Math.random()*2-1)*0.5}
else if(type==='pink'){let b0=0,b1=0,b2=0,b3=0,b4=0,b5=0,b6=0;for(let i=0;i<len;i++){const w=Math.random()*2-1;b0=0.99886*b0+w*0.0555179;b1=0.99332*b1+w*0.0750759;b2=0.969*b2+w*0.153852;b3=0.8665*b3+w*0.3104856;b4=0.55*b4+w*0.5329522;b5=-0.7616*b5-w*0.016898;L[i]=R[i]=(b0+b1+b2+b3+b4+b5+b6+w*0.5362)*0.11;b6=w*0.115926}}
else if(type==='rain'){let b0=0,b1=0,b2=0,b3=0,b4=0,b5=0,b6=0;for(let i=0;i<len;i++){const w=Math.random()*2-1;b0=0.99886*b0+w*0.0555179;b1=0.99332*b1+w*0.0750759;b2=0.969*b2+w*0.153852;b3=0.8665*b3+w*0.3104856;b4=0.55*b4+w*0.5329522;b5=-0.7616*b5-w*0.016898;const p=(b0+b1+b2+b3+b4+b5+b6+w*0.5362)*0.06;b6=w*0.115926;L[i]=p;R[i]=p;if(Math.random()<0.001){const di=Math.random()*0.4;for(let j=0;j<150&&i+j<len;j++){const de=Math.exp(-j/20);L[i+j]+=di*de*(Math.random()-0.5);R[i+j]+=di*de*(Math.random()-0.5)*0.8}}}}
else if(type==='wave'){for(let i=0;i<len;i++){const t=i/sr,cycle=t%8,phase=cycle/8;let env=phase<0.5?Math.sin(phase*Math.PI):Math.sin(phase*Math.PI)*0.3;let n=(Math.random()*2-1)*0.3*env;L[i]=n;R[i]=n*(0.9+Math.random()*0.2)}}
else if(type==='fire'){for(let i=0;i<len;i++){let n=(Math.random()*2-1)*0.15;if(Math.random()<0.003){const ci=0.3+Math.random()*0.4;for(let j=0;j<400&&i+j<len;j++){const ce=Math.exp(-j/60),cf=200+Math.random()*300;L[i+j]+=ci*ce*Math.sin(j/sr*cf*Math.PI*2)*(0.5+Math.random()*0.5)}}if(Math.random()<0.008){const pi=0.2+Math.random()*0.3;for(let j=0;j<80&&i+j<len;j++){const pe=Math.exp(-j/15);L[i+j]+=pi*pe*(Math.random()-0.5)}}L[i]+=n;R[i]=L[i]*(0.85+Math.random()*0.3)}}
return buf}
function toggleSound(el){const type=el.dataset.sound;if(el.classList.contains('active')){el.classList.remove('active');if(activeNodes[type]){activeNodes[type].src.stop();delete activeNodes[type]}}else{el.classList.add('active');const ctx=getCtx(),buf=createSoundBuffer(type),src=ctx.createBufferSource(),gain=ctx.createGain();src.buffer=buf;src.loop=true;const slider=el.querySelector('.sound-slider');gain.gain.value=masterVol*(slider?slider.value/100:0.7);src.connect(gain);gain.connect(ctx.destination);src.start();activeNodes[type]={src,gain,vol:slider?slider.value/100:0.7}}}
function setSoundVol(slider){const el=slider.closest('.sound-item'),type=el.dataset.sound;if(activeNodes[type]){activeNodes[type].vol=slider.value/100;activeNodes[type].gain.gain.value=masterVol*activeNodes[type].vol}}
function setMasterVol(v){masterVol=v/100;document.getElementById('masterVolValue').textContent=v+'%';Object.values(activeNodes).forEach(n=>n.gain.gain.value=masterVol*n.vol)}
function setSoundTimer(btn,min){document.querySelectorAll('.timer-btn').forEach(b=>b.classList.remove('active'));btn.classList.add('active');if(soundTimer)clearInterval(soundTimer);soundTimerEnd=Date.now()+min*60*1000;updateTimerDisplay();soundTimer=setInterval(()=>{if(Date.now()>=soundTimerEnd){stopAllSounds();clearInterval(soundTimer);document.getElementById('timerDisplay').textContent='å·²åœæ­¢';document.querySelectorAll('.timer-btn').forEach(b=>b.classList.remove('active'))}else updateTimerDisplay()},1000)}
function updateTimerDisplay(){const left=Math.max(0,soundTimerEnd-Date.now()),m=Math.floor(left/60000),s=Math.floor((left%60000)/1000);document.getElementById('timerDisplay').textContent=`${m}:${s.toString().padStart(2,'0')} åè‡ªåŠ¨åœæ­¢`}
function stopAllSounds(){Object.keys(activeNodes).forEach(k=>{activeNodes[k].src.stop();delete activeNodes[k]});document.querySelectorAll('.sound-item').forEach(el=>el.classList.remove('active'));if(soundTimer){clearInterval(soundTimer);soundTimer=null}document.getElementById('timerDisplay').textContent=''}

// ========== è§¦æ„Ÿæ¨¡å—ï¼ˆé‡å†™ï¼‰==========
let currentTouch='ball';
let ballPressing=false,ballPressure=0,ballVibInterval=null,ballRecoverInterval=null;
let sandCtx=null,sandDrawing=false,sandLastX=0,sandLastY=0,sandHasDrawn=false;
let zenCtx=null,zenDrawing=false,zenLastX=0,zenLastY=0,zenPattern='spiral',zenStrokes=0;

function switchTouch(mode){
    currentTouch=mode;
    document.querySelectorAll('.touch-tab').forEach(t=>t.classList.remove('active'));
    document.querySelector(`.touch-tab:nth-child(${mode==='ball'?1:mode==='sand'?2:3})`).classList.add('active');
    stopBallVibration();
    const area=document.getElementById('touchArea');
    const hint=document.getElementById('touchHint');
    
    if(mode==='ball'){
        area.innerHTML=`
            <div class="ball-container">
                <div class="ball-wrapper">
                    <div class="ball" id="theBall"></div>
                    <div class="ball-shadow" id="ballShadow"></div>
                </div>
                <div class="ball-pressure" id="ballPressure">é‡Šæ”¾å‹åŠ›...</div>
            </div>`;
        hint.innerHTML='æŒ‰ä½çƒä½“ï¼Œæ„Ÿå—å®ƒåœ¨æŒ‡å°–å˜å½¢<br>æŒ‰å¾—è¶Šä¹…ï¼Œè§£å‹æ•ˆæœè¶Šå¥½';
        initBall();
    }else if(mode==='sand'){
        area.innerHTML=`
            <div class="sand-container">
                <canvas class="sand-canvas" id="sandCanvas"></canvas>
                <div class="sand-guide" id="sandGuide">
                    <div class="sand-guide-icon">ğŸ–ï¸</div>
                    <div class="sand-guide-text">ç”¨æ‰‹æŒ‡åœ¨æ²™ä¸Šä½œç”»<br>ç”»å®Œåï¼Œè½»è½»æ‘‡åŠ¨æ¸…ç©º<br>ä¸€åˆ‡éƒ½ä¼šè¿‡å»</div>
                </div>
                <div class="sand-tools">
                    <button class="sand-btn" onclick="shakeSand()">ğŸ”„</button>
                </div>
                <div class="sand-quote">"åƒæ²™ä¸€æ ·ï¼Œè®©çƒ¦æ¼éšé£è€Œå»"</div>
            </div>`;
        hint.innerHTML='ç”¨æŒ‡å°–åœ¨æ²™ä¸Šå†™å­—æˆ–ç”»ç”»<br>æ‘‡ä¸€æ‘‡æ¸…ç©ºï¼Œè±¡å¾æ”¾ä¸‹æ‰§å¿µ';
        initSand();
    }else if(mode==='zen'){
        area.innerHTML=`
            <div class="zen-container">
                <canvas class="zen-canvas" id="zenCanvas"></canvas>
                <div class="zen-pattern-select">
                    <button class="zen-pattern-btn active" onclick="setZenPattern('spiral')">èºæ—‹</button>
                    <button class="zen-pattern-btn" onclick="setZenPattern('wave')">æ³¢æµª</button>
                    <button class="zen-pattern-btn" onclick="setZenPattern('circles')">åœ†ç¯</button>
                </div>
                <div class="zen-progress" id="zenProgress">è·Ÿéšç°è‰²å¼•å¯¼çº¿æ…¢æ…¢æç»˜</div>
            </div>`;
        hint.innerHTML='ç¦…ç»•ç”»ï¼šè·Ÿéšå¼•å¯¼çº¿æç»˜<br>ä¸ç”¨è¿½æ±‚å®Œç¾ï¼Œäº«å—è¿‡ç¨‹';
        initZen();
    }
}

// è§£å‹çƒ
function initBall(){
    const ball=document.getElementById('theBall');
    const shadow=document.getElementById('ballShadow');
    const pressureEl=document.getElementById('ballPressure');
    ballPressing=false;ballPressure=0;
    
    function startPress(e){
        e.preventDefault();
        ballPressing=true;
        pressureEl.style.opacity='1';
        if(ballRecoverInterval){clearInterval(ballRecoverInterval);ballRecoverInterval=null;}
        ballVibInterval=setInterval(()=>{
            if(ballPressure<100)ballPressure+=2;
            updateBallShape();
            if(ballPressure%10===0)vibrate(10+ballPressure/5);
        },50);
    }
    
    function endPress(){
        ballPressing=false;
        if(ballVibInterval){clearInterval(ballVibInterval);ballVibInterval=null;}
        vibrate([30,20,50]);
        // ç¼“æ…¢æ¢å¤
        ballRecoverInterval=setInterval(()=>{
            if(ballPressure>0){
                ballPressure-=1;
                updateBallShape();
            }else{
                clearInterval(ballRecoverInterval);
                ballRecoverInterval=null;
                pressureEl.style.opacity='0';
            }
        },30);
    }
    
    function updateBallShape(){
        const scale=1-ballPressure*0.003;
        const skewX=ballPressure*0.15;
        const borderRadius=50-ballPressure*0.15;
        ball.style.transform=`scale(${scale},${scale*0.85+0.15}) skewX(${skewX}deg)`;
        ball.style.borderRadius=`${borderRadius}% ${borderRadius}% ${50+ballPressure*0.2}% ${50+ballPressure*0.2}%`;
        shadow.style.width=(140+ballPressure*0.3)+'px';
        shadow.style.opacity=0.4+ballPressure*0.003;
        const msgs=['æŒ‰ä½ä¸æ”¾...','ç»§ç»­...','æ„Ÿå—å‹åŠ›é‡Šæ”¾...','å¾ˆå¥½ï¼Œç»§ç»­...','è®©å‹åŠ›æµèµ°...','ğŸ‰ å¤ªæ£’äº†ï¼'];
        pressureEl.textContent=msgs[Math.min(Math.floor(ballPressure/20),5)];
    }
    
    ball.ontouchstart=ball.onmousedown=startPress;
    ball.ontouchend=ball.onmouseup=ball.ontouchcancel=ball.onmouseleave=endPress;
}

function stopBallVibration(){
    if(ballVibInterval){clearInterval(ballVibInterval);ballVibInterval=null;}
    if(ballRecoverInterval){clearInterval(ballRecoverInterval);ballRecoverInterval=null;}
}

// æ²™ç›˜
function initSand(){
    const canvas=document.getElementById('sandCanvas');
    const ctx=canvas.getContext('2d');
    canvas.width=canvas.offsetWidth*2;
    canvas.height=canvas.offsetHeight*2;
    ctx.scale(2,2);
    // ç”»æ²™åº•
    drawSandBase(ctx,canvas.offsetWidth,canvas.offsetHeight);
    sandCtx=ctx;sandHasDrawn=false;
    
    function getPos(e){
        const r=canvas.getBoundingClientRect();
        const t=e.touches?e.touches[0]:e;
        return{x:t.clientX-r.left,y:t.clientY-r.top};
    }
    
    canvas.ontouchstart=canvas.onmousedown=(e)=>{
        e.preventDefault();
        sandDrawing=true;
        const p=getPos(e);
        sandLastX=p.x;sandLastY=p.y;
        if(!sandHasDrawn){
            document.getElementById('sandGuide').classList.add('hidden');
            sandHasDrawn=true;
        }
    };
    canvas.ontouchmove=canvas.onmousemove=(e)=>{
        if(!sandDrawing)return;
        e.preventDefault();
        const p=getPos(e);
        drawSandLine(sandCtx,sandLastX,sandLastY,p.x,p.y);
        sandLastX=p.x;sandLastY=p.y;
        vibrate(3);
    };
    canvas.ontouchend=canvas.onmouseup=canvas.ontouchcancel=()=>sandDrawing=false;
}

function drawSandBase(ctx,w,h){
    // æ²™å­åº•è‰²
    const grad=ctx.createLinearGradient(0,0,0,h);
    grad.addColorStop(0,'#d4a574');
    grad.addColorStop(1,'#c49a6c');
    ctx.fillStyle=grad;
    ctx.fillRect(0,0,w,h);
    // æ·»åŠ çº¹ç†
    for(let i=0;i<2000;i++){
        ctx.fillStyle=`rgba(${180+Math.random()*40},${140+Math.random()*30},${90+Math.random()*20},${0.3+Math.random()*0.3})`;
        ctx.fillRect(Math.random()*w,Math.random()*h,1,1);
    }
}

function drawSandLine(ctx,x1,y1,x2,y2){
    // ç”»å‡ºç—•è¿¹ï¼ˆæš—è‰²ï¼‰
    ctx.strokeStyle='#8b6914';
    ctx.lineWidth=10+Math.random()*5;
    ctx.lineCap='round';
    ctx.lineJoin='round';
    ctx.beginPath();
    ctx.moveTo(x1,y1);
    ctx.lineTo(x2,y2);
    ctx.stroke();
    // è¾¹ç¼˜é«˜å…‰
    ctx.strokeStyle='rgba(255,240,200,0.3)';
    ctx.lineWidth=2;
    ctx.beginPath();
    ctx.moveTo(x1-3,y1-3);
    ctx.lineTo(x2-3,y2-3);
    ctx.stroke();
}

function shakeSand(){
    vibrate([30,20,30,20,50]);
    const canvas=document.getElementById('sandCanvas');
    if(sandCtx){
        drawSandBase(sandCtx,canvas.offsetWidth,canvas.offsetHeight);
        sandHasDrawn=false;
        document.getElementById('sandGuide').classList.remove('hidden');
    }
}

// ç¦…ç»•ç”»
function initZen(){
    const canvas=document.getElementById('zenCanvas');
    const ctx=canvas.getContext('2d');
    canvas.width=canvas.offsetWidth*2;
    canvas.height=canvas.offsetHeight*2;
    ctx.scale(2,2);
    ctx.fillStyle='#f5f0e6';
    ctx.fillRect(0,0,canvas.offsetWidth,canvas.offsetHeight);
    zenCtx=ctx;zenStrokes=0;
    drawZenGuide();
    
    function getPos(e){
        const r=canvas.getBoundingClientRect();
        const t=e.touches?e
.touches[0]:e;
        return{x:t.clientX-r.left,y:t.clientY-r.top};
    }
    
    canvas.ontouchstart=canvas.onmousedown=(e)=>{
        e.preventDefault();
        zenDrawing=true;
        const p=getPos(e);
        zenLastX=p.x;zenLastY=p.y;
    };
    canvas.ontouchmove=canvas.onmousemove=(e)=>{
        if(!zenDrawing)return;
        e.preventDefault();
        const p=getPos(e);
        zenCtx.strokeStyle='#2d3436';
        zenCtx.lineWidth=2;
        zenCtx.lineCap='round';
        zenCtx.beginPath();
        zenCtx.moveTo(zenLastX,zenLastY);
        zenCtx.lineTo(p.x,p.y);
        zenCtx.stroke();
        zenLastX=p.x;zenLastY=p.y;
        zenStrokes++;
        if(zenStrokes%20===0)vibrate(5);
        updateZenProgress();
    };
    canvas.ontouchend=canvas.onmouseup=canvas.ontouchcancel=()=>zenDrawing=false;
}

function setZenPattern(pattern){
    zenPattern=pattern;
    document.querySelectorAll('.zen-pattern-btn').forEach(b=>b.classList.remove('active'));
    event.target.classList.add('active');
    const canvas=document.getElementById('zenCanvas');
    zenCtx.fillStyle='#f5f0e6';
    zenCtx.fillRect(0,0,canvas.offsetWidth,canvas.offsetHeight);
    zenStrokes=0;
    drawZenGuide();
    document.getElementById('zenProgress').textContent='è·Ÿéšç°è‰²å¼•å¯¼çº¿æ…¢æ…¢æç»˜';
}

function drawZenGuide(){
    const canvas=document.getElementById('zenCanvas');
    const w=canvas.offsetWidth,h=canvas.offsetHeight;
    const cx=w/2,cy=h/2;
    zenCtx.strokeStyle='rgba(0,0,0,0.1)';
    zenCtx.lineWidth=1;
    zenCtx.setLineDash([5,5]);
    
    if(zenPattern==='spiral'){
        zenCtx.beginPath();
        for(let i=0;i<720;i++){
            const angle=i*Math.PI/180;
            const r=10+i*0.15;
            const x=cx+r*Math.cos(angle);
            const y=cy+r*Math.sin(angle);
            i===0?zenCtx.moveTo(x,y):zenCtx.lineTo(x,y);
        }
        zenCtx.stroke();
    }else if(zenPattern==='wave'){
        for(let row=0;row<5;row++){
            zenCtx.beginPath();
            for(let x=20;x<w-20;x++){
                const y=60+row*50+Math.sin(x*0.05)*15;
                x===20?zenCtx.moveTo(x,y):zenCtx.lineTo(x,y);
            }
            zenCtx.stroke();
        }
    }else if(zenPattern==='circles'){
        for(let i=1;i<=5;i++){
            zenCtx.beginPath();
            zenCtx.arc(cx,cy,i*25,0,Math.PI*2);
            zenCtx.stroke();
        }
    }
    zenCtx.setLineDash([]);
}

function updateZenProgress(){
    const msgs=['åˆšå¼€å§‹...','ç»§ç»­æç»˜...','å¾ˆå¥½ï¼Œä¿æŒä¸“æ³¨...','è¿›å…¥å¿ƒæµçŠ¶æ€...','ğŸ§˜ å®Œç¾çš„ä¸“æ³¨'];
    const idx=Math.min(Math.floor(zenStrokes/100),4);
    document.getElementById('zenProgress').textContent=msgs[idx];
}
</script>
</body>
</html>
