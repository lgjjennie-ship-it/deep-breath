<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#1a1a2e">
    <title>æ·±å‘¼å¸ - 3åˆ†é’Ÿè§£å‹</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { font-family: -apple-system, BlinkMacSystemFont, sans-serif; background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%); min-height: 100vh; color: #f5f5f5; }
        .container { max-width: 420px; margin: 0 auto; padding: 20px; min-height: 100vh; }
        .header { text-align: center; padding: 30px 0 20px; }
        .header h1 { font-size: 28px; font-weight: 300; letter-spacing: 4px; margin-bottom: 8px; }
        .header p { font-size: 14px; color: #7f8fa6; }
        .mood-section { background: rgba(255,255,255,0.05); border-radius: 20px; padding: 24px; margin-bottom: 24px; }
        .mood-title { text-align: center; font-size: 16px; margin-bottom: 20px; color: #a29bfe; }
        .mood-options { display: flex; flex-wrap: wrap; gap: 12px; justify-content: center; }
        .mood-btn { background: rgba(255,255,255,0.08); border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; padding: 12px 16px; font-size: 14px; color: #f5f5f5; cursor: pointer; }
        .modules { display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; }
        .module-card { background: rgba(255,255,255,0.06); border-radius: 16px; padding: 24px 12px; text-align: center; cursor: pointer; }
        .module-icon { font-size: 32px; margin-bottom: 12px; }
        .module-name { font-size: 14px; color: #ddd; }
        .module-card.disabled { opacity: 0.4; pointer-events: none; }
        .page { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%); z-index: 100; padding: 20px; }
        .page.active { display: flex; flex-direction: column; }
        .page-header { display: flex; justify-content: space-between; align-items: center; padding: 10px 0 20px; }
        .back-btn { background: rgba(255,255,255,0.1); border: none; border-radius: 50%; width: 40px; height: 40px; color: #f5f5f5; font-size: 20px; cursor: pointer; }
        .page-title { font-size: 18px; }
        .page-content { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .breath-circle-container { width: 220px; height: 220px; margin-bottom: 40px; }
        .breath-circle { width: 100%; height: 100%; border-radius: 50%; background: radial-gradient(circle, rgba(162,155,254,0.4), rgba(162,155,254,0.1) 70%); box-shadow: 0 0 60px rgba(162,155,254,0.3); display: flex; align-items: center; justify-content: center; transition: transform 4s ease-in-out; }
        .breath-circle.inhale { transform: scale(1.3); }
        .breath-circle.exhale { transform: scale(0.8); }
        .breath-timer { font-size: 48px; font-weight: 200; }
        .breath-status { margin-top: 20px; font-size: 16px; color: #7f8fa6; }
        .breath-progress { margin-top: 10px; font-size: 14px; color: #555; }
        .start-btn { margin-top: 40px; background: linear-gradient(135deg, #a29bfe, #6c5ce7); border: none; border-radius: 30px; padding: 16px 48px; font-size: 16px; color: #fff; cursor: pointer; }
        .bubble-container { position: absolute; top: 70px; left: 0; right: 0; bottom: 60px; overflow: hidden; }
        .bubble { position: absolute; border-radius: 50%; background: radial-gradient(circle at 30% 30%, rgba(255,255,255,0.9), rgba(162,155,254,0.5) 60%, rgba(108,92,231,0.3)); cursor: pointer; animation: float 3s ease-in-out infinite; box-shadow: inset 0 -8px 25px rgba(162,155,254,0.4), 0 8px 20px rgba(0,0,0,0.15); }
        .bubble::before { content: ''; position: absolute; top: 12%; left: 18%; width: 35%; height: 25%; background: linear-gradient(135deg, rgba(255,255,255,0.9), rgba(255,255,255,0.2)); border-radius: 50%; }
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-15px); } }
        @keyframes pop { 0% { transform: scale(1); opacity: 1; } 100% { transform: scale(1.5); opacity: 0; } }
        .bubble.pop { animation: pop 0.15s ease-out forwards; pointer-events: none; }
        .bubble-score { position: absolute; bottom: 20px; left: 0; right: 0; text-align: center; font-size: 16px; color: #a29bfe; }
        .pop-text { position: absolute; font-size: 24px; pointer-events: none; animation: popText 0.5s ease-out forwards; }
        @keyframes popText { 0% { transform: scale(0.5); opacity: 1; } 100% { transform: scale(1.2) translateY(-30px); opacity: 0; } }
        .sound-list { width: 100%; max-width: 360px; }
        .sound-item { background: rgba(255,255,255,0.06); border-radius: 16px; padding: 20px; margin-bottom: 16px; display: flex; align-items: center; justify-content: space-between; cursor: pointer; border: 1px solid transparent; }
        .sound-item.active { background: rgba(255,255,255,0.1); border-color: #a29bfe; }
        .sound-info { display: flex; align-items: center; gap: 16px; }
        .sound-icon { font-size: 28px; }
        .sound-name { font-size: 16px; }
        .sound-desc { font-size: 12px; color: #7f8fa6; }
        .sound-toggle { width: 50px; height: 28px; background: rgba(255,255,255,0.1); border-radius: 14px; position: relative; }
        .sound-toggle::after { content: ''; position: absolute; top: 4px; left: 4px; width: 20px; height: 20px; background: #fff; border-radius: 50%; transition: left 0.3s; }
        .sound-item.active .sound-toggle { background: #a29bfe; }
        .sound-item.active .sound-toggle::after { left: 26px; }
        .volume-control { margin-top: 30px; width: 100%; max-width: 360px; }
        .volume-label { font-size: 14px; color: #7f8fa6; margin-bottom: 12px; display: flex; justify-content: space-between; }
        .volume-slider { width: 100%; -webkit-appearance: none; height: 6px; background: rgba(255,255,255,0.1); border-radius: 3px; }
        .volume-slider::-webkit-slider-thumb { -webkit-appearance: none; width: 20px; height: 20px; background: #a29bfe; border-radius: 50%; }
        .footer { text-align: center; padding: 30px 0; font-size: 12px; color: #555; }
    </style>
</head>
<body>
    <div class="container" id="home">
        <div class="header"><h1>æ·±å‘¼å¸</h1><p>åŸºäºè„‘ç§‘å­¦çš„3åˆ†é’Ÿè§£å‹</p></div>
        <div class="mood-section">
            <div class="mood-title">ç°åœ¨æ„Ÿè§‰æ€ä¹ˆæ ·ï¼Ÿ</div>
            <div class="mood-options">
                <button class="mood-btn" onclick="openPage('breath')">ğŸ˜° å¾ˆç„¦è™‘</button>
                <button class="mood-btn" onclick="openPage('sound')">ğŸ˜” æœ‰ç‚¹ä¸§</button>
                <button class="mood-btn" onclick="openPage('bubble')">ğŸ˜¤ çƒ¦èº</button>
                <button class="mood-btn" onclick="openPage('sound')">ğŸ¥± ç–²æƒ«</button>
                <button class="mood-btn" onclick="openPage('breath')">ğŸ˜¶ è¯´ä¸æ¸…</button>
            </div>
        </div>
        <div class="modules">
            <div class="module-card" onclick="openPage('breath')"><div class="module-icon">ğŸ«</div><div class="module-name">å‘¼å¸</div></div>
            <div class="module-card" onclick="openPage('bubble')"><div class="module-icon">ğŸ«§</div><div class="module-name">æ³¡æ³¡</div></div>
            <div class="module-card" onclick="openPage('sound')"><div class="module-icon">ğŸµ</div><div class="module-name">å£°éŸ³</div></div>
            <div class="module-card disabled"><div class="module-icon">ğŸŒ€</div><div class="module-name">å‘å‘†</div></div>
            <div class="module-card disabled"><div class="module-icon">ğŸ–ï¸</div><div class="module-name">è§¦æ„Ÿ</div></div>
            <div class="module-card disabled"><div class="module-icon">ğŸ’¬</div><div class="module-name">å€¾è¯‰</div></div>
        </div>
        <div class="footer">æ¯ä¸ªåŠŸèƒ½éƒ½æœ‰ç§‘å­¦ä¾æ®</div>
    </div>

    <div class="page" id="breath-page">
        <div class="page-header"><button class="back-btn" onclick="closePage()">â†</button><div class="page-title">4-7-8 å‘¼å¸æ³•</div><div style="width:40px"></div></div>
        <div class="page-content">
            <div class="breath-circle-container"><div class="breath-circle" id="breathCircle"><div class="breath-timer" id="breathTimer">4</div></div></div>
            <div class="breath-status" id="breathStatus">å‡†å¤‡å¥½äº†å—ï¼Ÿ</div>
            <div class="breath-progress" id="breathProgress"></div>
            <button class="start-btn" id="breathBtn" onclick="toggleBreath()">å¼€å§‹å‘¼å¸</button>
        </div>
    </div>

    <div class="page" id="bubble-page">
        <div class="page-header"><button class="back-btn" onclick="closePage()">â†</button><div class="page-title">ææ³¡æ³¡è§£å‹</div><div style="width:40px"></div></div>
        <div class="bubble-container" id="bubbleContainer"></div>
        <div class="bubble-score">å·²æçˆ† <span id="bubbleCount">0</span> ä¸ª ğŸ‰</div>
    </div>

    <div class="page" id="sound-page">
        <div class="page-header"><button class="back-btn" onclick="closePage()">â†</button><div class="page-title">å£°éŸ³ç–—æ„ˆ</div><div style="width:40px"></div></div>
        <div class="page-content">
            <div class="sound-list">
                <div class="sound-item" data-sound="rain" onclick="toggleSound(this)"><div class="sound-info"><span class="sound-icon">ğŸŒ§ï¸</span><div><div class="sound-name">é›¨å£°</div><div class="sound-desc">æ·…æ·…æ²¥æ²¥çš„å°é›¨</div></div></div><div class="sound-toggle"></div></div>
                <div class="sound-item" data-sound="wave" onclick="toggleSound(this)"><div class="sound-info"><span class="sound-icon">ğŸŒŠ</span><div><div class="sound-name">æµ·æµª</div><div class="sound-desc">æœ‰èŠ‚å¥çš„æ½®èµ·æ½®è½</div></div></div><div class="sound-toggle"></div></div>
                <div class="sound-item" data-sound="fire" onclick="toggleSound(this)"><div class="sound-info"><span class="sound-icon">ğŸ”¥</span><div><div class="sound-name">ç¯ç«</div><div class="sound-desc">å™¼å•ªä½œå“çš„ç«ç„°</div></div></div><div class="sound-toggle"></div></div>
                <div class="sound-item" data-sound="white" onclick="toggleSound(this)"><div class="sound-info"><span class="sound-icon">ğŸ“»</span><div><div class="sound-name">ç™½å™ªéŸ³</div><div class="sound-desc">å‡åŒ€çš„å˜¶å˜¶å£°</div></div></div><div class="sound-toggle"></div></div>
            </div>
            <div class="volume-control"><div class="volume-label"><span>éŸ³é‡</span><span id="volumeValue">50%</span></div><input type="range" class="volume-slider" id="volumeSlider" min="0" max="100" value="50" oninput="setVolume(this.value)"></div>
        </div>
    </div>

    <script>
        function openPage(p){document.getElementById(p+'-page').classList.add('active');document.getElementById('home').style.display='none';if(p==='bubble')initBubbles();vibrate(30);}
        function closePage(){document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));document.getElementById('home').style.display='block';if(breathInterval)stopBreath();stopAllSounds();}
        function vibrate(p){if(navigator.vibrate)navigator.vibrate(p);}

        // å‘¼å¸
        let breathInterval=null,breathPhase=0,breathCount=0,breathTimer=0;
        const breathCfg={inhale:4,hold:7,exhale:8,rounds:4};
        function toggleBreath(){breathInterval?stopBreath():startBreath();}
        function startBreath(){breathPhase=0;breathCount=0;breathTimer=breathCfg.inhale;document.getElementById('breathBtn').textContent='åœæ­¢';document.getElementById('breathCircle').className='breath-circle inhale';updateBreathUI();breathInterval=setInterval(()=>{breathTimer--;if(breathTimer<=0){breathPhase++;if(breathPhase>2){breathPhase=0;breathCount++;if(breathCount>=breathCfg.rounds){completeBreath();return;}}switch(breathPhase){case 0:breathTimer=breathCfg.inhale;document.getElementById('breathCircle').className='breath-circle inhale';break;case 1:breathTimer=breathCfg.hold;document.getElementById('breathCircle').className='breath-circle';break;case 2:breathTimer=breathCfg.exhale;document.getElementById('breathCircle').className='breath-circle exhale';break;}vibrate(50);}updateBreathUI();},1000);}
        function updateBreathUI(){document.getElementById('breathTimer').textContent=breathTimer;document.getElementById('breathStatus').textContent=['å¸æ°”...','å±ä½...','å‘¼æ°”...'][breathPhase];document.getElementById('breathProgress').textContent=`ç¬¬ ${breathCount+1}/${breathCfg.rounds} è½®`;}
        function stopBreath(){clearInterval(breathInterval);breathInterval=null;document.getElementById('breathBtn').textContent='å¼€å§‹å‘¼å¸';document.getElementById('breathStatus').textContent='å‡†å¤‡å¥½äº†å—ï¼Ÿ';document.getElementById('breathProgress').textContent='';document.getElementById('breathCircle').className='breath-circle';document.getElementById('breathTimer').textContent='4';}
        function completeBreath(){stopBreath();document.getElementById('breathStatus').textContent='âœ¨ å®Œæˆï¼æ„Ÿè§‰å¥½ç‚¹äº†å—ï¼Ÿ';vibrate([100,50,100]);}

        // æ³¡æ³¡
        let bubbleCount=0,popCtx=null;
        function initBubbles(){const c=document.getElementById('bubbleContainer');c.innerHTML='';bubbleCount=0;document.getElementById('bubbleCount').textContent='0';for(let i=0;i<12;i++)createBubble();if(!popCtx)popCtx=new(window.AudioContext||window.webkitAudioContext)();}
        function createBubble(){const c=document.getElementById('bubbleContainer'),b=document.createElement('div');b.className='bubble';const s=50+Math.random()*45;b.style.width=s+'px';b.style.height=s+'px';b.style.left=(10+Math.random()*(c.offsetWidth-s-20))+'px';b.style.top=(10+Math.random()*(c.offsetHeight-s-20))+'px';b.style.animationDelay=Math.random()*2+'s';b.ontouchstart=b.onclick=function(e){e.preventDefault();e.stopPropagation();popBubble(this);};c.appendChild(b);}
        function playPopSound(){if(!popCtx)return;if(popCtx.state==='suspended')popCtx.resume();const o=popCtx.createOscillator(),g=popCtx.createGain();o.type='sine';o.frequency.setValueAtTime(800+Math.random()*600,popCtx.currentTime);o.frequency.exponentialRampToValueAtTime(200,popCtx.currentTime+0.08);g.gain.setValueAtTime(0.25,popCtx.currentTime);g.gain.exponentialRampToValueAtTime(0.01,popCtx.currentTime+0.08);o.connect(g);g.connect(popCtx.destination);o.start();o.stop(popCtx.currentTime+0.08);const n=popCtx.createBufferSource(),nb=popCtx.createBuffer(1,popCtx.sampleRate*0.06,popCtx.sampleRate),nd=nb.getChannelData(0);for(let i=0;i<nb.length;i++)nd[i]=(Math.random()*2-1)*Math.exp(-i/(nb.length*0.15));n.buffer=nb;const ng=popCtx.createGain();ng.gain.value=0.2;n.connect(ng);ng.connect(popCtx.destination);n.start();}
        function popBubble(b){if(b.classList.contains('pop'))return;playPopSound();vibrate([20,15,30]);const r=b.getBoundingClientRect();showPopFx(r.left+r.width/2,r.top+r.height/2);b.classList.add('pop');bubbleCount++;document.getElementById('bubbleCount').textContent=bubbleCount;setTimeout(()=>{b.remove();createBubble();if(Math.random()>0.5)createBubble();},150);}
        function showPopFx(x,y){const e=['ğŸ’¥','âœ¨','ğŸ’«','â­'][Math.floor(Math.random()*4)],el=document.createElement('div');el.className='pop-text';el.textContent=e;el.style.left=x+'px';el.style.top=y+'px';document.getElementById('bubble-page').appendChild(el);setTimeout(()=>el.remove(),500);}

        // å£°éŸ³ - å®Œå…¨ä¸åŒçš„éŸ³è‰²
        let audioCtx=null;const activeNodes={};let vol=0.5;
        function getCtx(){if(!audioCtx)audioCtx=new(window.AudioContext||window.webkitAudioContext)();if(audioCtx.state==='suspended')audioCtx.resume();return audioCtx;}
        
        function createSoundBuffer(type){
            const ctx=getCtx(),sr=ctx.sampleRate,len=sr*4,buf=ctx.createBuffer(2,len,sr),L=buf.getChannelData(0),R=buf.getChannelData(1);
            if(type==='white'){
                for(let i=0;i<len;i++){L[i]=R[i]=(Math.random()*2-1)*0.5;}
            }else if(type==='rain'){
                let b0=0,b1=0,b2=0,b3=0,b4=0,b5=0,b6=0;
                for(let i=0;i<len;i++){
                    const w=Math.random()*2-1;b0=0.99886*b0+w*0.0555179;b1=0.99332*b1+w*0.0750759;b2=0.96900*b2+w*0.1538520;b3=0.86650*b3+w*0.3104856;b4=0.55000*b4+w*0.5329522;b5=-0.7616*b5-w*0.0168980;
                    const p=(b0+b1+b2+b3+b4+b5+b6+w*0.5362)*0.06;b6=w*0.115926;
                    L[i]=p;R[i]=p;
                    if(Math.random()<0.001){const di=Math.random()*0.4;for(let j=0;j<150&&i+j<len;j++){const de=Math.exp(-j/20);L[i+j]+=di*de*(Math.random()-0.5);R[i+j]+=di*de*(Math.random()-0.5)*0.8;}}
                }
            }else if(type==='wave'){
                for(let i=0;i<len;i++){
                    const t=i/sr,cycle=t%8,phase=cycle/8;
                    let env=phase<0.5?Math.sin(phase*Math.PI):Math.sin(phase*Math.PI)*0.3;
                    let n=(Math.random()*2-1)*0.3*env;
                    const lfo=Math.sin(t*0.5)*0.2;n+=lfo*env*0.1;
                    L[i]=n;R[i]=n*(0.9+Math.random()*0.2);
                }
            }else if(type==='fire'){
                for(let i=0;i<len;i++){
                    let n=(Math.random()*2-1)*0.15;
                    if(Math.random()<0.003){const ci=0.3+Math.random()*0.4;for(let j=0;j<400&&i+j<len;j++){const ce=Math.exp(-j/60);const cf=200+Math.random()*300;L[i+j]+=ci*ce*Math.sin(j/sr*cf*Math.PI*2)*(0.5+Math.random()*0.5);}}
                    if(Math.random()<0.008){const pi=0.2+Math.random()*0.3;for(let j=0;j<80&&i+j<len;j++){const pe=Math.exp(-j/15);L[i+j]+=pi*pe*(Math.random()-0.5);}}
                    L[i]+=n;R[i]=L[i]*(0.85+Math.random()*0.3);
                }
            }
            return buf;
        }

        function toggleSound(el){
            const type=el.dataset.sound;
            if(el.classList.contains('active')){
                el.classList.remove('active');
                if(activeNodes[type]){activeNodes[type].src.stop();delete activeNodes[type];}
            }else{
                el.classList.add('active');
                const ctx=getCtx(),buf=createSoundBuffer(type),src=ctx.createBufferSource(),gain=ctx.createGain();
                src.buffer=buf;src.loop=true;gain.gain.value=vol;
                src.connect(gain);gain.connect(ctx.destination);src.start();
                activeNodes[type]={src,gain};
            }
        }
        function setVolume(v){vol=v/100;document.getElementById('volumeValue').textContent=v+'%';Object.values(activeNodes).forEach(n=>n.gain.gain.value=vol);}
        function stopAllSounds(){Object.keys(activeNodes).forEach(k=>{activeNodes[k].src.stop();delete activeNodes[k];});document.querySelectorAll('.sound-item').forEach(el=>el.classList.remove('active'));}
    </script>
</body>
</html>
