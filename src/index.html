<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#1a1a2e">
    <title id="pageTitle">æ·±å‘¼å¸ - 3åˆ†é’Ÿè§£å‹</title>
    <style>
        :root{--bg1:#1a1a2e;--bg2:#16213e;--bg3:#0f3460;--accent:#a29bfe;--accent2:#6c5ce7;--text:#f5f5f5;--text2:#7f8fa6;--text3:#555}
        *{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent;user-select:none}
        body{font-family:-apple-system,BlinkMacSystemFont,sans-serif;background:linear-gradient(135deg,var(--bg1),var(--bg2),var(--bg3));min-height:100vh;color:var(--text)}
        .container{max-width:420px;margin:0 auto;padding:20px;min-height:100vh}
        .header{text-align:center;padding:30px 0 20px}
        .header h1{font-size:28px;font-weight:300;letter-spacing:4px}
        .header p{font-size:14px;color:var(--text2);margin-top:8px}
        .mood-section{background:rgba(255,255,255,0.05);border-radius:20px;padding:24px;margin-bottom:24px}
        .mood-title{text-align:center;font-size:16px;color:var(--accent);margin-bottom:8px}
        .mood-desc{text-align:center;font-size:12px;color:var(--text3);margin-bottom:20px}
        .mood-options{display:flex;flex-wrap:wrap;gap:12px;justify-content:center}
        .mood-btn{background:rgba(255,255,255,0.08);border:1px solid rgba(255,255,255,0.1);border-radius:12px;padding:12px 16px;font-size:14px;color:var(--text);cursor:pointer}
        .mood-btn.selected{background:rgba(162,155,254,0.3);border-color:var(--accent)}
        .recommend-section{display:none;background:rgba(162,155,254,0.1);border-radius:16px;padding:20px;margin-bottom:24px}
        .recommend-section.show{display:block}
        .recommend-title{font-size:14px;color:var(--accent);margin-bottom:12px}
        .recommend-btns{display:flex;gap:12px;flex-wrap:wrap}
        .recommend-btn{background:rgba(162,155,254,0.2);border:1px solid var(--accent);border-radius:20px;padding:10px 20px;font-size:14px;color:#fff;cursor:pointer}
        .modules{display:grid;grid-template-columns:repeat(3,1fr);gap:16px}
        .module-card{background:rgba(255,255,255,0.06);border-radius:16px;padding:24px 12px;text-align:center;cursor:pointer}
        .module-icon{font-size:32px;margin-bottom:12px}
        .module-name{font-size:14px;color:#ddd}
        .page{display:none;position:fixed;top:0;left:0;right:0;bottom:0;background:linear-gradient(135deg,var(--bg1),var(--bg2),var(--bg3));z-index:100;overflow-y:auto}
        .page.active{display:flex;flex-direction:column}
        .page-header{display:flex;justify-content:space-between;align-items:center;padding:15px 20px}
        .back-btn{background:rgba(255,255,255,0.1);border:none;border-radius:50%;width:40px;height:40px;color:var(--text);font-size:20px;cursor:pointer}
        .page-title{font-size:18px}
        .page-content{flex:1;display:flex;flex-direction:column;align-items:center;padding:20px}
        .science-card{background:rgba(162,155,254,0.1);border-radius:16px;padding:16px 20px;margin-bottom:25px;width:100%;max-width:360px;border-left:3px solid var(--accent)}
        .science-card h4{font-size:13px;color:var(--accent);margin-bottom:8px}
        .science-card p{font-size:12px;color:#9f9f9f;line-height:1.6}
        .science-card .source{font-size:11px;color:var(--text3);margin-top:8px;font-style:italic}
        .breath-circle-container{width:200px;height:200px;margin-bottom:30px}
        .breath-circle{width:100%;height:100%;border-radius:50%;background:radial-gradient(circle,rgba(162,155,254,0.4),rgba(162,155,254,0.1) 70%);box-shadow:0 0 60px rgba(162,155,254,0.3);display:flex;align-items:center;justify-content:center;transition:transform 4s,box-shadow 4s}
        .breath-circle.inhale{transform:scale(1.3);box-shadow:0 0 80px rgba(162,155,254,0.5)}
        .breath-circle.exhale{transform:scale(0.8)}
        .breath-timer{font-size:48px;font-weight:200}
        .breath-status{margin-top:20px;font-size:20px;color:var(--accent)}
        .breath-progress{margin-top:8px;font-size:14px;color:var(--text3)}
        .start-btn{margin-top:30px;background:linear-gradient(135deg,var(--accent),var(--accent2));border:none;border-radius:30px;padding:16px 48px;font-size:16px;color:#fff;cursor:pointer}
        .breath-modes{margin-top:20px;display:flex;gap:10px}
        .breath-mode{background:rgba(255,255,255,0.1);border:none;border-radius:20px;padding:10px 16px;font-size:12px;color:var(--text2);cursor:pointer}
        .breath-mode.active{background:rgba(162,155,254,0.3);color:var(--text)}
        .daze-container{position:fixed;top:0;left:0;right:0;bottom:0;display:flex;align-items:center;justify-content:center}
        .daze-canvas{position:absolute;top:0;left:0;width:100%;height:100%}
        .daze-timer{position:absolute;bottom:100px;font-size:48px;font-weight:200;color:rgba(255,255,255,0.3);z-index:1}
        .daze-hint{position:absolute;bottom:60px;font-size:12px;color:rgba(255,255,255,0.2);z-index:1}
        .daze-exit{position:absolute;top:20px;right:20px;background:rgba(255,255,255,0.1);border:none;border-radius:50%;width:40px;height:40px;color:rgba(255,255,255,0.5);font-size:16px;cursor:pointer;z-index:2}
        .bubble-container{position:absolute;top:70px;left:0;right:0;bottom:120px;overflow:hidden}
        .bubble{position:absolute;border-radius:50%;background:radial-gradient(circle at 30% 30%,rgba(255,255,255,0.9),rgba(162,155,254,0.5) 60%,rgba(108,92,231,0.3));cursor:pointer;animation:float 3s ease-in-out infinite}
        .bubble::before{content:'';position:absolute;top:12%;left:18%;width:35%;height:25%;background:linear-gradient(135deg,rgba(255,255,255,0.9),rgba(255,255,255,0.2));border-radius:50%}
        @keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-15px)}}
        .bubble.pop{animation:pop .15s forwards;pointer-events:none}
        @keyframes pop{to{transform:scale(1.5);opacity:0}}
        .bubble-footer{position:absolute;bottom:0;left:0;right:0;padding:15px 20px;background:rgba(26,26,46,0.95)}
        .bubble-score{text-align:center;font-size:16px;color:var(--accent);margin-bottom:10px}
        .bubble-tip{text-align:center;font-size:11px;color:var(--text3)}
        .pop-text{position:absolute;font-size:24px;pointer-events:none;animation:popText .5s forwards;z-index:10}
        @keyframes popText{to{transform:scale(1.2) translateY(-30px);opacity:0}}
        .tear-container{width:100%;display:flex;flex-direction:column;align-items:center}
        .paper-styles{display:flex;gap:8px;margin-bottom:20px}
        .paper-style-btn{width:48px;height:56px;border-radius:6px;border:2px solid transparent;cursor:pointer;font-size:9px;display:flex;align-items:flex-end;justify-content:center;padding-bottom:4px}
        .paper-style-btn.active{border-color:var(--accent);transform:scale(1.1);box-shadow:0 4px 15px rgba(162,155,254,0.4)}
        .style-note{background:linear-gradient(180deg,#fffde7,#fff9c4);color:#795548}
        .style-pink{background:linear-gradient(180deg,#fce4ec,#f8bbd9);color:#880e4f}
        .style-blue{background:linear-gradient(180deg,#e3f2fd,#bbdefb);color:#1565c0}
        .style-dark{background:linear-gradient(180deg,#455a64,#263238);color:#90a4ae}
        .style-kraft{background:linear-gradient(180deg,#d7ccc8,#a1887f);color:#4e342e}
        .tear-paper{width:92%;max-width:340px;min-height:200px;border-radius:3px;padding:20px 24px;box-shadow:0 10px 40px rgba(0,0,0,0.5);position:relative}
        .tear-paper textarea{width:100%;height:140px;background:transparent;border:none;outline:none;font-size:16px;color:inherit;resize:none;line-height:2}
        .tear-paper textarea::placeholder{color:inherit;opacity:0.35}
        .tear-paper-lines{position:absolute;top:58px;left:24px;right:24px;bottom:20px;pointer-events:none;opacity:0.12;background:repeating-linear-gradient(transparent,transparent 31px,currentColor 32px)}
        .tear-paper-fold{position:absolute;top:0;right:0;border-style:solid;border-width:0 28px 28px 0;border-color:transparent rgba(0,0,0,0.1) transparent transparent}
        .tear-actions{margin-top:28px;display:flex;gap:12px}
        .tear-btn{border:none;border-radius:25px;padding:14px 28px;font-size:15px;color:#fff;cursor:pointer;font-weight:500}
        .rip-btn{background:linear-gradient(135deg,#7c4dff,#651fff)}
        .burn-btn{background:linear-gradient(135deg,#ff6d00,#ff3d00)}
        .destroy-overlay{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.95);z-index:200;display:none;justify-content:center;align-items:center;flex-direction:column}
        .destroy-overlay.active{display:flex}
        .destroy-stage{position:relative;width:280px;height:180px}
        .destroy-paper{width:100%;height:100%;border-radius:3px;padding:20px;font-size:14px;line-height:1.6;word-break:break-all;overflow:hidden}
        .destroy-paper.ripping{animation:ripPaper 1.8s forwards}
        @keyframes ripPaper{0%{clip-path:inset(0)}30%{clip-path:polygon(0 0,52% 0,48% 30%,55% 60%,45% 100%,0 100%)}60%{clip-path:polygon(0 0,25% 0,20% 40%,30% 80%,10% 100%,0 100%);transform:translateX(-40px) rotate(-8deg)}100%{clip-path:polygon(0 0,0 0,0 100%,0 100%);opacity:0}}
        .destroy-paper.burning{animation:burnPaper 2.5s forwards}
        @keyframes burnPaper{0%{filter:brightness(1)}30%{filter:brightness(1.5) sepia(0.5)}60%{filter:brightness(2) sepia(1);clip-path:polygon(0 100%,100% 100%,100% 50%,80% 40%,60% 55%,40% 35%,20% 50%,0 40%)}100%{filter:brightness(3);clip-path:polygon(0 100%,100% 100%,100% 100%,0 100%);opacity:0}}
        .rip-pieces{position:absolute;top:0;left:0;width:100%;height:100%;pointer-events:none}
        .rip-piece{position:absolute;border-radius:2px}
        .rip-piece.fly{animation:pieceFly 1.2s forwards}
        @keyframes pieceFly{0%{opacity:1}100%{opacity:0;transform:translate(var(--tx),var(--ty)) rotate(var(--rot))}}
        .fire-particles{position:absolute;bottom:0;left:0;right:0;height:100%;pointer-events:none}
        .fire-p{position:absolute;border-radius:50%;animation:fireUp .8s forwards}
        @keyframes fireUp{to{transform:translateY(-120px) scale(0);opacity:0}}
        .ash-container{position:fixed;top:0;left:0;right:0;bottom:0;pointer-events:none;z-index:201}
        .ash{position:absolute;background:#333;border-radius:50%;animation:ashDrop 3s forwards}
        @keyframes ashDrop{0%{opacity:0.6}100%{transform:translateY(100vh) rotate(720deg);opacity:0}}
        .destroy-complete{position:absolute;text-align:center;opacity:0}
        .destroy-complete.show{animation:completeShow .6s 1s forwards}
        @keyframes completeShow{to{opacity:1}}
        .destroy-icon{font-size:72px;margin-bottom:20px}
        .destroy-text{font-size:22px;font-weight:300;color:#fff;margin-bottom:8px}
        .destroy-sub{font-size:14px;color:var(--text2);margin-bottom:30px}
        .destroy-close{background:rgba(255,255,255,0.1);border:1px solid rgba(255,255,255,0.2);border-radius:25px;padding:12px 32px;color:#fff;font-size:14px;cursor:pointer}
        .sound-content{width:100%;max-width:380px}
        .sound-item{background:rgba(255,255,255,0.06);border-radius:16px;padding:16px 20px;margin-bottom:12px;border:1px solid transparent}
        .sound-item.active{background:rgba(255,255,255,0.1);border-color:var(--accent)}
        .sound-row{display:flex;align-items:center;justify-content:space-between;cursor:pointer}
        .sound-info{display:flex;align-items:center;gap:14px}
        .sound-icon{font-size:26px}
        .sound-name{font-size:15px}
        .sound-desc{font-size:11px;color:var(--text2)}
        .sound-toggle{width:50px;height:28px;background:rgba(255,255,255,0.1);border-radius:14px;position:relative}
        .sound-toggle::after{content:'';position:absolute;top:4px;left:4px;width:20px;height:20px;background:#fff;border-radius:50%;transition:left .3s}
        .sound-item.active .sound-toggle{background:var(--accent)}
        .sound-item.active .sound-toggle::after{left:26px}
        .sound-slider-wrap{margin-top:12px;display:none}
        .sound-item.active .sound-slider-wrap{display:block}
        .sound-slider{width:100%;height:4px;-webkit-appearance:none;background:rgba(255,255,255,0.1);border-radius:2px}
        .sound-slider::-webkit-slider-thumb{-webkit-appearance:none;width:16px;height:16px;background:var(--accent);border-radius:50%}
        .master-volume{margin-top:20px;padding:16px;background:rgba(255,255,255,0.05);border-radius:16px}
        .master-label{font-size:14px;color:var(--text2);margin-bottom:12px;display:flex;justify-content:space-between}
        .timer-section{margin-top:20px;text-align:center}
        .timer-btns{display:flex;gap:10px;justify-content:center}
        .timer-btn{background:rgba(255,255,255,0.08);border:1px solid rgba(255,255,255,0.1);border-radius:20px;padding:8px 16px;font-size:13px;color:var(--text);cursor:pointer}
        .timer-btn.active{background:rgba(162,155,254,0.3);border-color:var(--accent)}
        .timer-display{margin-top:12px;font-size:13px;color:var(--text3)}
        .touch-tabs{display:flex;gap:8px;margin-bottom:20px}
        .touch-tab{background:rgba(255,255,255,0.08);border:1px solid rgba(255,255,255,0.1);border-radius:20px;padding:10px 16px;font-size:13px;color:var(--text);cursor:pointer}
        .touch-tab.active{background:rgba(162,155,254,0.3);border-color:var(--accent)}
        .touch-area{width:100%;max-width:340px;height:340px;border-radius:20px;overflow:hidden;position:relative;background:#1a1a2e}
        .touch-hint{text-align:center;font-size:12px;color:var(--text3);margin-top:16px;line-height:1.6}
        .ball-container{width:100%;height:100%;display:flex;align-items:center;justify-content:center;background:radial-gradient(circle at 50% 60%,#2d1b4e,#1a1a2e);position:relative}
        .ball-wrapper{position:relative;width:180px;height:180px}
        .ball{width:100%;height:100%;border-radius:50%;background:radial-gradient(circle at 30% 25%,#ffb8d0,#ff6b9d 30%,#e91e8c 60%,#b8156b 85%);box-shadow:0 30px 60px rgba(0,0,0,0.5);cursor:pointer}
        .ball-shadow{position:absolute;bottom:-30px;left:50%;transform:translateX(-50%);width:140px;height:20px;background:radial-gradient(ellipse,rgba(0,0,0,0.4),transparent 70%);border-radius:50%}
        .ball-pressure{position:absolute;bottom:20px;left:50%;transform:translateX(-50%);font-size:14px;color:var(--accent);opacity:0}
        .sand-container{width:100%;height:100%;position:relative}
        .sand-canvas{width:100%;height:100%;touch-action:none;cursor:crosshair}
        .sand-guide{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);text-align:center;color:rgba(255,255,255,0.3);pointer-events:none}
        .sand-guide.hidden{opacity:0}
        .sand-guide-icon{font-size:48px;margin-bottom:12px}
        .sand-guide-text{font-size:14px;line-height:1.6}
        .sand-tools{position:absolute;top:10px;right:10px}
        .sand-btn{background:rgba(255,255,255,0.15);border:none;border-radius:50%;width:40px;height:40px;font-size:18px;cursor:pointer;color:#fff}
        .sand-quote{position:absolute;bottom:15px;left:15px;right:15px;text-align:center;font-size:11px;color:rgba(255,255,255,0.25);font-style:italic}
        .zen-container{width:100%;height:100%;position:relative}
        .zen-canvas{width:100%;height:100%;touch-action:none;background:#f5f0e6;border-radius:16px}
        .zen-pattern-select{position:absolute;top:10px;left:10px;right:10px;display:flex;gap:8px;justify-content:center}
        .zen-pattern-btn{background:rgba(0,0,0,0.1);border:none;border-radius:8px;padding:6px 12px;font-size:11px;color:#666;cursor:pointer}
        .zen-pattern-btn.active{background:var(--accent);color:#fff}
        .zen-progress{position:absolute;bottom:15px;left:50%;transform:translateX(-50%);font-size:12px;color:var(--text3)}
        .footer{text-align:center;padding:30px 0;font-size:12px;color:var(--text3)}
    </style>
</head>
<body>
    <div class="container" id="home">
        <div class="header"><h1>æ·±å‘¼å¸</h1><p>åŸºäºè„‘ç§‘å­¦çš„3åˆ†é’Ÿè§£å‹</p></div>
        <div class="mood-section">
            <div class="mood-title">ç°åœ¨æ„Ÿè§‰æ€ä¹ˆæ ·ï¼Ÿ</div>
            <div class="mood-desc">é€‰æ‹©åä¸ºä½ æ¨èæœ€é€‚åˆçš„è§£å‹æ–¹å¼</div>
            <div class="mood-options">
                <button class="mood-btn" onclick="selectMood(this,'anxious')">ğŸ˜° å¾ˆç„¦è™‘</button>
                <button class="mood-btn" onclick="selectMood(this,'sad')">ğŸ˜” æœ‰ç‚¹ä¸§</button>
                <button class="mood-btn" onclick="selectMood(this,'angry')">ğŸ˜¤ çƒ¦èº</button>
                <button class="mood-btn" onclick="selectMood(this,'tired')">ğŸ¥± ç–²æƒ«</button>
                <button class="mood-btn" onclick="selectMood(this,'unclear')">ğŸ˜¶ è¯´ä¸æ¸…</button>
            </div>
        </div>
        <div class="recommend-section" id="recommendSection">
            <div class="recommend-title">ğŸ’¡ ä¸ºä½ æ¨è</div>
            <div class="recommend-btns" id="recommendBtns"></div>
        </div>
        <div class="modules">
            <div class="module-card" onclick="openPage('breath')"><div class="module-icon">ğŸ«</div><div class="module-name">å‘¼å¸</div></div>
            <div class="module-card" onclick="openPage('daze')"><div class="module-icon">ğŸŒ€</div><div class="module-name">å‘å‘†</div></div>
            <div class="module-card" onclick="openPage('bubble')"><div class="module-icon">ğŸ«§</div><div class="module-name">æ³¡æ³¡</div></div>
            <div class="module-card" onclick="openPage('tear')"><div class="module-icon">ğŸ“„</div><div class="module-name">æ’•çº¸</div></div>
            <div class="module-card" onclick="openPage('sound')"><div class="module-icon">ğŸµ</div><div class="module-name">å£°éŸ³</div></div>
            <div class="module-card" onclick="openPage('touch')"><div class="module-icon">ğŸ–ï¸</div><div class="module-name">è§¦æ„Ÿ</div></div>
        </div>
        <div class="footer">æ¯ä¸ªåŠŸèƒ½éƒ½æœ‰ç§‘å­¦ä¾æ®</div>
    </div>

    <div class="page" id="breath-page">
        <div class="page-header"><button class="back-btn" onclick="closePage()">â†</button><div class="page-title">ğŸ« ç§‘å­¦å‘¼å¸</div><div style="width:40px"></div></div>
        <div class="page-content">
            <div class="science-card"><h4>ğŸ”¬ ç§‘å­¦åŸç†</h4><p>4-7-8å‘¼å¸æ³•æ¿€æ´»è¿·èµ°ç¥ç»ï¼Œè§¦å‘å‰¯äº¤æ„Ÿç¥ç»"ä¼‘æ¯-æ¶ˆåŒ–"ååº”ï¼Œ60ç§’å†…å¯æ˜¾è‘—é™ä½å¿ƒç‡ã€‚</p><div class="source">â€” Dr. Andrew Weil, Harvard</div></div>
            <div class="breath-circle-container"><div class="breath-circle" id="breathCircle"><div class="breath-timer" id="breathTimer">4</div></div></div>
            <div class="breath-status" id="breathStatus">å‡†å¤‡å¥½äº†å—ï¼Ÿ</div>
            <div class="breath-progress" id="breathProgress"></div>
            <button class="start-btn" id="breathBtn" onclick="toggleBreath()">å¼€å§‹å‘¼å¸</button>
            <div class="breath-modes"><button class="breath-mode active" data-mode="478" onclick="setBreathMode(this)">4-7-8</button><button class="breath-mode" data-mode="box" onclick="setBreathMode(this)">æ–¹å—å‘¼å¸</button></div>
        </div>
    </div>

    <div class="page" id="daze-page">
        <div class="daze-container">
            <button class="daze-exit" onclick="closePage()">âœ•</button>
            <canvas class="daze-canvas" id="dazeCanvas"></canvas>
            <div class="daze-timer" id="dazeTimer">3:00</div>
            <div class="daze-hint">ä»€ä¹ˆéƒ½ä¸ç”¨åš</div>
        </div>
    </div>

    <div class="page" id="bubble-page">
        <div class="page-header"><button class="back-btn" onclick="closePage()">â†</button><div class="page-title">ğŸ«§ ææ³¡æ³¡</div><div style="width:40px"></div></div>
        <div class="bubble-container" id="bubbleContainer"></div>
        <div class="bubble-footer">
            <div class="bubble-score">å·²æçˆ† <span id="bubbleCount">0</span> ä¸ª ğŸ‰</div>
            <div class="bubble-tip">ğŸ”¬ å…·èº«è®¤çŸ¥ï¼šæ¨¡æ‹Ÿç ´åå¯é‡Šæ”¾å‹åŠ›</div>
        </div>
    </div>

    <div class="page" id="tear-page">
        <div class="page-header"><button class="back-btn" onclick="closePage()">â†</button><div class="page-title">ğŸ“„ æ’•æ‰çƒ¦æ¼</div><div style="width:40px"></div></div>
        <div class="page-content">
            <div class="science-card"><h4>ğŸ”¬ ç§‘å­¦åŸç†</h4><p>è¡¨è¾¾æ€§å†™ä½œå¯æ˜¾è‘—é™ä½ç„¦è™‘ã€‚å†™ä¸‹è´Ÿé¢æƒ…ç»ªç„¶å"é”€æ¯"ï¼Œè±¡å¾æ€§å‘Šåˆ«å®ƒä»¬ã€‚</p><div class="source">â€” Pennebaker, 1997</div></div>
            <div class="tear-container">
                <div class="paper-styles">
                    <div class="paper-style-btn style-note active" onclick="setPaperStyle('note')">ä¾¿ç­¾</div>
                    <div class="paper-style-btn style-pink" onclick="setPaperStyle('pink')">ç²‰è‰²</div>
                    <div class="paper-style-btn style-blue" onclick="setPaperStyle('blue')">è“è‰²</div>
                    <div class="paper-style-btn style-dark" onclick="setPaperStyle('dark')">æš—é»‘</div>
                    <div class="paper-style-btn style-kraft" onclick="setPaperStyle('kraft')">ç‰›çš®</div>
                </div>
                <div class="tear-paper style-note" id="tearPaper">
                    <textarea id="tearText" placeholder="å†™ä¸‹è®©ä½ çƒ¦æ¼çš„äº‹..."></textarea>
                    <div class="tear-paper-lines"></div>
                    <div class="tear-paper-fold"></div>
                </div>
                <div class="tear-actions">
                    <button class="tear-btn rip-btn" onclick="destroyPaper('rip')">âœ‚ï¸ æ’•ç¢å®ƒ</button>
                    <button class="tear-btn burn-btn" onclick="destroyPaper('burn')">ğŸ”¥ çƒ§æ‰å®ƒ</button>
                </div>
            </div>
        </div>
    </div>

    <div class="destroy-overlay" id="destroyOverlay">
        <div class="destroy-stage">
            <div class="destroy-paper" id="destroyPaper"></div>
            <div class="rip-pieces" id="ripPieces"></div>
            <div class="fire-particles" id="fireParticles"></div>
        </div>
        <div class="ash-container" id="ashContainer"></div>
        <div class="destroy-complete" id="destroyComplete">
            <span class="destroy-icon" id="destroyIcon">âœ¨</span>
            <div class="destroy-text" id="destroyText">çƒ¦æ¼å·²æ¶ˆæ•£</div>
            <div class="destroy-sub">è®©è¿‡å»çš„è¿‡å»ï¼Œæ‹¥æŠ±æ–°çš„å¼€å§‹</div>
            <button class="destroy-close" onclick="closeDestroy()">ç»§ç»­å‰è¡Œ</button>
        </div>
    </div>

    <div class="page" id="sound-page">        <div class="page-header"><button class="back-btn" onclick="closePage()">â†</button><div class="page-title">ğŸµ å£°éŸ³ç–—æ„ˆ</div><div style="width:40px"></div></div>
        <div class="page-content">
            <div class="science-card"><h4>ğŸ”¬ ç§‘å­¦åŸç†</h4><p>ç‰¹å®šé¢‘ç‡å£°éŸ³å½±å“è„‘ç”µæ³¢ã€‚ç²‰çº¢å™ªéŸ³å¢å¼ºæ·±åº¦ç¡çœ ï¼Œè‡ªç„¶éŸ³å”¤èµ·å®‰å…¨æ„Ÿã€‚</p><div class="source">â€” J. Theoretical Biology, 2012</div></div>
            <div class="sound-content">
                <div class="sound-item" data-sound="rain"><div class="sound-row" onclick="toggleSound(this.parentElement)"><div class="sound-info"><span class="sound-icon">ğŸŒ§ï¸</span><div><div class="sound-name">é›¨å£°</div><div class="sound-desc">æ·…æ·…æ²¥æ²¥</div></div></div><div class="sound-toggle"></div></div><div class="sound-slider-wrap"><input type="range" class="sound-slider" min="0" max="100" value="70" onchange="setSoundVol(this)"></div></div>
                <div class="sound-item" data-sound="wave"><div class="sound-row" onclick="toggleSound(this.parentElement)"><div class="sound-info"><span class="sound-icon">ğŸŒŠ</span><div><div class="sound-name">æµ·æµª</div><div class="sound-desc">æ½®èµ·æ½®è½</div></div></div><div class="sound-toggle"></div></div><div class="sound-slider-wrap"><input type="range" class="sound-slider" min="0" max="100" value="70" onchange="setSoundVol(this)"></div></div>
                <div class="sound-item" data-sound="fire"><div class="sound-row" onclick="toggleSound(this.parentElement)"><div class="sound-info"><span class="sound-icon">ğŸ”¥</span><div><div class="sound-name">ç¯ç«</div><div class="sound-desc">å™¼å•ªä½œå“</div></div></div><div class="sound-toggle"></div></div><div class="sound-slider-wrap"><input type="range" class="sound-slider" min="0" max="100" value="70" onchange="setSoundVol(this)"></div></div>
                <div class="sound-item" data-sound="white"><div class="sound-row" onclick="toggleSound(this.parentElement)"><div class="sound-info"><span class="sound-icon">ğŸ“»</span><div><div class="sound-name">ç™½å™ªéŸ³</div><div class="sound-desc">å˜¶å˜¶å£°</div></div></div><div class="sound-toggle"></div></div><div class="sound-slider-wrap"><input type="range" class="sound-slider" min="0" max="100" value="70" onchange="setSoundVol(this)"></div></div>
                <div class="master-volume"><div class="master-label"><span>æ€»éŸ³é‡</span><span id="masterVolValue">50%</span></div><input type="range" class="sound-slider" id="masterVolume" min="0" max="100" value="50" oninput="setMasterVol(this.value)"></div>
                <div class="timer-section"><div class="timer-btns"><button class="timer-btn" onclick="setSoundTimer(this,15)">15åˆ†é’Ÿ</button><button class="timer-btn" onclick="setSoundTimer(this,30)">30åˆ†é’Ÿ</button><button class="timer-btn" onclick="setSoundTimer(this,60)">60åˆ†é’Ÿ</button></div><div class="timer-display" id="timerDisplay"></div></div>
            </div>
        </div>
    </div>

    <div class="page" id="touch-page">
        <div class="page-header"><button class="back-btn" onclick="closePage()">â†</button><div class="page-title">ğŸ–ï¸ è§¦æ„Ÿè§£å‹</div><div style="width:40px"></div></div>
        <div class="page-content">
            <div class="science-card"><h4>ğŸ”¬ ç§‘å­¦åŸç†</h4><p>é‡å¤æ‰‹éƒ¨åŠ¨ä½œæ¿€æ´»ç¨‹åºæ€§è®°å¿†ï¼Œç»•è¿‡ç„¦è™‘ç›¸å…³å‰é¢å¶ï¼Œäº§ç”Ÿå¿ƒæµçŠ¶æ€ã€‚</p><div class="source">â€” Csikszentmihalyi, 1990</div></div>
            <div class="touch-tabs">
                <button class="touch-tab active" onclick="switchTouch('ball')">ğŸ”® è§£å‹çƒ</button>
                <button class="touch-tab" onclick="switchTouch('sand')">ğŸ–ï¸ ç¦…æ„æ²™ç›˜</button>
                <button class="touch-tab" onclick="switchTouch('zen')">ğŸŒ€ ç¦…ç»•ç”»</button>
            </div>
            <div class="touch-area" id="touchArea"></div>
            <div class="touch-hint" id="touchHint">æŒ‰ä½çƒä½“ï¼Œæ„Ÿå—å®ƒåœ¨æŒ‡å°–å˜å½¢</div>
        </div>
    </div>

<script>
const titles={home:'æ·±å‘¼å¸ - 3åˆ†é’Ÿè§£å‹',breath:'ç§‘å­¦å‘¼å¸',daze:'å‘å‘†æ¨¡å¼',bubble:'ææ³¡æ³¡',tear:'æ’•æ‰çƒ¦æ¼',sound:'å£°éŸ³ç–—æ„ˆ',touch:'è§¦æ„Ÿè§£å‹'};
const moodRec={anxious:[{n:'ğŸ« å‘¼å¸',p:'breath'},{n:'ğŸ“» ç™½å™ªéŸ³',p:'sound'}],sad:[{n:'ğŸŒ§ï¸ é›¨å£°',p:'sound'},{n:'ğŸŒ€ å‘å‘†',p:'daze'}],angry:[{n:'ğŸ«§ æ³¡æ³¡',p:'bubble'},{n:'ğŸ“„ æ’•çº¸',p:'tear'}],tired:[{n:'ğŸ”¥ ç¯ç«',p:'sound'},{n:'ğŸŒ€ å‘å‘†',p:'daze'}],unclear:[{n:'ğŸ« å‘¼å¸',p:'breath'},{n:'ğŸ–ï¸ è§¦æ„Ÿ',p:'touch'}]};
function selectMood(btn,mood){document.querySelectorAll('.mood-btn').forEach(b=>b.classList.remove('selected'));btn.classList.add('selected');vibrate(30);const s=document.getElementById('recommendSection'),c=document.getElementById('recommendBtns');c.innerHTML=moodRec[mood].map(r=>`<button class="recommend-btn" onclick="openPage('${r.p}')">${r.n}</button>`).join('');s.classList.add('show')}
function openPage(p){document.getElementById(p+'-page').classList.add('active');document.getElementById('home').style.display='none';document.getElementById('pageTitle').textContent=titles[p];if(p==='bubble')initBubbles();if(p==='daze')initDaze();if(p==='touch')switchTouch('ball');vibrate(30)}
function closePage(){document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));document.getElementById('home').style.display='block';document.getElementById('pageTitle').textContent=titles.home;if(breathInterval)stopBreath();if(dazeInterval)stopDaze();stopAllSounds();stopBallVibration()}
function vibrate(p){if(navigator.vibrate)navigator.vibrate(p)}

// å‘¼å¸
let breathInterval=null,breathPhase=0,breathCount=0,breathTimer=0,breathCfg={inhale:4,hold:7,exhale:8,rounds:4};
function setBreathMode(btn){document.querySelectorAll('.breath-mode').forEach(b=>b.classList.remove('active'));btn.classList.add('active');breathCfg=btn.dataset.mode==='478'?{inhale:4,hold:7,exhale:8,rounds:4}:{inhale:4,hold:4,exhale:4,hold2:4,rounds:4};document.getElementById('breathTimer').textContent=breathCfg.inhale}
function toggleBreath(){breathInterval?stopBreath():startBreath()}
function startBreath(){breathPhase=0;breathCount=0;breathTimer=breathCfg.inhale;document.getElementById('breathBtn').textContent='åœæ­¢';document.getElementById('breathCircle').className='breath-circle inhale';updateBreathUI();breathInterval=setInterval(()=>{breathTimer--;if(breathTimer<=0){breathPhase++;const max=breathCfg.hold2?3:2;if(breathPhase>max){breathPhase=0;breathCount++;if(breathCount>=breathCfg.rounds){completeBreath();return}}switch(breathPhase){case 0:breathTimer=breathCfg.inhale;document.getElementById('breathCircle').className='breath-circle inhale';break;case 1:breathTimer=breathCfg.hold;document.getElementById('breathCircle').className='breath-circle';break;case 2:breathTimer=breathCfg.exhale;document.getElementById('breathCircle').className='breath-circle exhale';break;case 3:breathTimer=breathCfg.hold2;document.getElementById('breathCircle').className='breath-circle';break}vibrate(50)}updateBreathUI()},1000)}
function updateBreathUI(){document.getElementById('breathTimer').textContent=breathTimer;document.getElementById('breathStatus').textContent=['å¸æ°”...','å±ä½...','å‘¼æ°”...','å±ä½...'][breathPhase];document.getElementById('breathProgress').textContent=`ç¬¬ ${breathCount+1}/${breathCfg.rounds} è½®`}
function stopBreath(){clearInterval(breathInterval);breathInterval=null;document.getElementById('breathBtn').textContent='å¼€å§‹å‘¼å¸';document.getElementById('breathStatus').textContent='å‡†å¤‡å¥½äº†å—ï¼Ÿ';document.getElementById('breathProgress').textContent='';document.getElementById('breathCircle').className='breath-circle';document.getElementById('breathTimer').textContent=breathCfg.inhale}
function completeBreath(){stopBreath();document.getElementById('breathStatus').textContent='âœ¨ å®Œæˆï¼';vibrate([100,50,100])}

// å‘å‘†
let dazeInterval=null,dazeTime=180;
function initDaze(){const c=document.getElementById('dazeCanvas'),ctx=c.getContext('2d');c.width=window.innerWidth;c.height=window.innerHeight;dazeTime=180;updateDazeTimer();const blobs=[];for(let i=0;i<5;i++)blobs.push({x:Math.random()*c.width,y:Math.random()*c.height,r:80+Math.random()*60,dx:(Math.random()-0.5)*0.5,dy:(Math.random()-0.5)*0.5,hue:240+Math.random()*60});function draw(){ctx.fillStyle='rgba(26,26,46,0.03)';ctx.fillRect(0,0,c.width,c.height);blobs.forEach(b=>{b.x+=b.dx;b.y+=b.dy;if(b.x<0||b.x>c.width)b.dx*=-1;if(b.y<0||b.y>c.height)b.dy*=-1;const g=ctx.createRadialGradient(b.x,b.y,0,b.x,b.y,b.r);g.addColorStop(0,`hsla(${b.hue},60%,50%,0.3)`);g.addColorStop(1,'transparent');ctx.fillStyle=g;ctx.beginPath();ctx.arc(b.x,b.y,b.r,0,Math.PI*2);ctx.fill()});requestAnimationFrame(draw)}draw();dazeInterval=setInterval(()=>{dazeTime--;updateDazeTimer();if(dazeTime<=0)closePage()},1000)}
function updateDazeTimer(){document.getElementById('dazeTimer').textContent=`${Math.floor(dazeTime/60)}:${(dazeTime%60).toString().padStart(2,'0')}`}
function stopDaze(){if(dazeInterval){clearInterval(dazeInterval);dazeInterval=null}}

// æ³¡æ³¡
let bubbleCount=0,popCtx=null;
function initBubbles(){const c=document.getElementById('bubbleContainer');c.innerHTML='';bubbleCount=0;document.getElementById('bubbleCount').textContent='0';for(let i=0;i<12;i++)createBubble();if(!popCtx)popCtx=new(window.AudioContext||window.webkitAudioContext)()}
function createBubble(){const c=document.getElementById('bubbleContainer'),b=document.createElement('div');b.className='bubble';const s=50+Math.random()*45;b.style.cssText=`width:${s}px;height:${s}px;left:${10+Math.random()*(c.offsetWidth-s-20)}px;top:${10+Math.random()*(c.offsetHeight-s-20)}px;animation-delay:${Math.random()*2}s`;b.ontouchstart=b.onclick=e=>{e.preventDefault();popBubble(b)};c.appendChild(b)}
function playPopSound(){if(!popCtx)return;if(popCtx.state==='suspended')popCtx.resume();const o=popCtx.createOscillator(),g=popCtx.createGain();o.type='sine';o.frequency.setValueAtTime(800+Math.random()*600,popCtx.currentTime);o.frequency.exponentialRampToValueAtTime(200,popCtx.currentTime+0.08);g.gain.setValueAtTime(0.25,popCtx.currentTime);g.gain.exponentialRampToValueAtTime(0.01,popCtx.currentTime+0.08);o.connect(g);g.connect(popCtx.destination);o.start();o.stop(popCtx.currentTime+0.08)}
function popBubble(b){if(b.classList.contains('pop'))return;playPopSound();vibrate([20,15,30]);b.classList.add('pop');bubbleCount++;document.getElementById('bubbleCount').textContent=bubbleCount;setTimeout(()=>{b.remove();createBubble();if(Math.random()>0.5)createBubble()},150)}

// æ’•çº¸
let paperStyle='note';
function setPaperStyle(style){paperStyle=style;document.querySelectorAll('.paper-style-btn').forEach(b=>b.classList.remove('active'));document.querySelector(`.style-${style}`).classList.add('active');const paper=document.getElementById('tearPaper');paper.className=`tear-paper style-${style}`}
function destroyPaper(mode){const text=document.getElementById('tearText').value;if(!text.trim()){vibrate(100);return}vibrate([50,30,50,30,100]);const overlay=document.getElementById('destroyOverlay');const paper=document.getElementById('destroyPaper');const complete=document.getElementById('destroyComplete');paper.className=`destroy-paper style-${paperStyle}`;paper.textContent=text.substring(0,100)+(text.length>100?'...':'');complete.classList.remove('show');overlay.classList.add('active');setTimeout(()=>{if(mode==='rip'){paper.classList.add('ripping');createRipPieces();document.getElementById('destroyIcon').textContent='âœ‚ï¸';document.getElementById('destroyText').textContent='ç¢ç‰‡å·²é£˜æ•£'}else{paper.classList.add('burning');createFireParticles();createAsh();document.getElementById('destroyIcon').textContent='ğŸ”¥';document.getElementById('destroyText').textContent='ç°é£çƒŸç­'}vibrate([100,50,100,50,200]);setTimeout(()=>{complete.classList.add('show')},mode==='rip'?1500:2000)},100)}
function createRipPieces(){const cont=document.getElementById('ripPieces');cont.innerHTML='';const colors=['#fffde7','#fff9c4','#fce4ec','#e3f2fd','#d7ccc8'];for(let i=0;i<25;i++){const p=document.createElement('div');p.className='rip-piece';p.style.cssText=`width:${15+Math.random()*30}px;height:${20+Math.random()*40}px;left:${30+Math.random()*40}%;top:${20+Math.random()*60}%;background:${colors[Math.floor(Math.random()*colors.length)]};--tx:${(Math.random()-0.5)*400}px;--ty:${100+Math.random()*300}px;--rot:${Math.random()*1080}deg`;setTimeout(()=>p.classList.add('fly'),100+i*30);cont.appendChild(p)}}
function createFireParticles(){const cont=document.getElementById('fireParticles');cont.innerHTML='';const colors=['#ff6600','#ff9900','#ffcc00','#ff3300'];for(let i=0;i<40;i++){const p=document.createElement('div');p.className='fire-p';const size=4+Math.random()*8;p.style.cssText=`width:${size}px;height:${size}px;left:${10+Math.random()*80}%;bottom:${Math.random()*50}%;background:${colors[Math.floor(Math.random()*colors.length)]};animation-delay:${Math.random()*1.5}s`;cont.appendChild(p)}}
function createAsh(){const cont=document.getElementById('ashContainer');cont.innerHTML='';for(let i=0;i<30;i++){const a=document.createElement('div');a.className='ash';const size=2+Math.random()*4;a.style.cssText=`width:${size}px;height:${size}px;left:${Math.random()*100}%;top:${20+Math.random()*30}%;animation-delay:${0.5+Math.random()*2}s`;cont.appendChild(a)}}
function closeDestroy(){document.getElementById('destroyOverlay').classList.remove('active');document.getElementById('destroyPaper').className='destroy-paper';document.getElementById('tearText').value='';document.getElementById('ripPieces').innerHTML='';document.getElementById('fireParticles').innerHTML='';document.getElementById('ashContainer').innerHTML=''}

// å£°éŸ³
let audioCtx=null;const activeNodes={};let masterVol=0.5,soundTimer=null,soundTimerEnd=0;
function getCtx(){if(!audioCtx)audioCtx=new(window.AudioContext||window.webkitAudioContext)();if(audioCtx.state==='suspended')audioCtx.resume();return audioCtx}
function createSoundBuffer(type){const ctx=getCtx(),sr=ctx.sampleRate,len=sr*4,buf=ctx.createBuffer(2,len,sr),L=buf.getChannelData(0),R=buf.getChannelData(1);if(type==='white')for(let i=0;i<len;i++)L[i]=R[i]=(Math.random()*2-1)*0.5;else if(type==='rain'){let b0=0,b1=0,b2=0,b3=0,b4=0,b5=0,b6=0;for(let i=0;i<len;i++){const w=Math.random()*2-1;b0=0.99886*b0+w*0.0555;b1=0.99332*b1+w*0.0751;b2=0.969*b2+w*0.1539;b3=0.8665*b3+w*0.3105;b4=0.55*b4+w*0.533;b5=-0.7616*b5-w*0.0169;const p=(b0+b1+b2+b3+b4+b5+b6+w*0.5362)*0.06;b6=w*0.116;L[i]=p;R[i]=p;if(Math.random()<0.001)for(let j=0;j<150&&i+j<len;j++){const de=Math.exp(-j/20);L[i+j]+=0.3*de*(Math.random()-0.5)}}}else if(type==='wave')for(let i=0;i<len;i++){const t=i/sr,phase=(t%8)/8;const env=phase<0.5?Math.sin(phase*Math.PI):Math.sin(phase*Math.PI)*0.3;L[i]=R[i]=(Math.random()*2-1)*0.3*env}else if(type==='fire')for(let i=0;i<len;i++){let n=(Math.random()*2-1)*0.15;if(Math.random()<0.005)for(let j=0;j<300&&i+j<len;j++)L[i+j]+=0.3*Math.exp(-j/50)*Math.sin(j/sr*300*Math.PI*2);L[i]+=n;R[i]=L[i]*(0.85+Math.random()*0.3)}return buf}
function toggleSound(el){const type=el.dataset.sound;if(el.classList.contains('active')){el.classList.remove('active');if(activeNodes[type]){activeNodes[type].src.stop();delete activeNodes[type]}}else{el.classList.add('active');const ctx=getCtx(),buf=createSoundBuffer(type),src=ctx.createBufferSource(),gain=ctx.createGain();src.buffer=buf;src.loop=true;const slider=el.querySelector('.sound-slider');gain.gain.value=masterVol*(slider?slider.value/100:0.7);src.connect(gain);gain.connect(ctx.destination);src.start();activeNodes[type]={src,gain,vol:slider?slider.value/100:0.7}}}
function setSoundVol(slider){const el=slider.closest('.sound-item'),type=el.dataset.sound;if(activeNodes[type]){activeNodes[type].vol=slider.value/100;activeNodes[type].gain.gain.value=masterVol*activeNodes[type].vol}}
function setMasterVol(v){masterVol=v/100;document.getElementById('masterVolValue').textContent=v+'%';Object.values(activeNodes).forEach(n=>n.gain.gain.value=masterVol*n.vol)}
function setSoundTimer(btn,min){document.querySelectorAll('.timer-btn').forEach(b=>b.classList.remove('active'));btn.classList.add('active');if(soundTimer)clearInterval(soundTimer);soundTimerEnd=Date.now()+min*60*1000;updateTimerDisplay();soundTimer=setInterval(()=>{if(Date.now()>=soundTimerEnd){stopAllSounds();clearInterval(soundTimer);document.getElementById('timerDisplay').textContent='å·²åœæ­¢'}else updateTimerDisplay()},1000)}
function updateTimerDisplay(){const left=Math.max(0,soundTimerEnd-Date.now()),m=Math.floor(left/60000),s=Math.floor((left%60000)/1000);document.getElementById('timerDisplay').textContent=`${m}:${s.toString().padStart(2,'0')} ååœæ­¢`}
function stopAllSounds(){Object.keys(activeNodes).forEach(k=>{activeNodes[k].src.stop();delete activeNodes[k]});document.querySelectorAll('.sound-item').forEach(el=>el.classList.remove('active'));if(soundTimer){clearInterval(soundTimer);soundTimer=null}document.getElementById('timerDisplay').textContent=''}

// è§¦æ„Ÿ
let ballPressing=false,ballPressure=0,ballVibInterval=null,ballRecoverInterval=null;
let sandCtx=null,sandDrawing=false,sandLastX=0,sandLastY=0,sandHasDrawn=false;
let zenCtx=null,zenDrawing=false,zenLastX=0,zenLastY=0,zenPattern='spiral',zenStrokes=0;
function switchTouch(mode){document.querySelectorAll('.touch-tab').forEach(t=>t.classList.remove('active'));document.querySelector(`.touch-tab:nth-child(${mode==='ball'?1:mode==='sand'?2:3})`).classList.add('active');stopBallVibration();const area=document.getElementById('touchArea'),hint=document.getElementById('touchHint');if(mode==='ball'){area.innerHTML='<div class="ball-container"><div class="ball-wrapper"><div class="ball" id="theBall"></div><div class="ball-shadow" id="ballShadow"></div></div><div class="ball-pressure" id="ballPressure"></div></div>';hint.innerHTML='æŒ‰ä½çƒä½“ï¼Œæ„Ÿå—å®ƒåœ¨æŒ‡å°–å˜å½¢';initBall()}else if(mode==='sand'){area.innerHTML='<div class="sand-container"><canvas class="sand-canvas" id="sandCanvas"></canvas><div class="sand-guide" id="sandGuide"><div class="sand-guide-icon">ğŸ–ï¸</div><div class="sand-guide-text">ç”¨æ‰‹æŒ‡åœ¨æ²™ä¸Šä½œç”»</div></div><div class="sand-tools"><button class="sand-btn" onclick="shakeSand()">ğŸ”„</button></div><div class="sand-quote">"è®©çƒ¦æ¼éšé£è€Œå»"</div></div>';hint.innerHTML='åœ¨æ²™ä¸Šç”»ç”»ï¼Œæ‘‡ä¸€æ‘‡æ¸…ç©º';initSand()}else{area.innerHTML='<div class="zen-container"><canvas class="zen-canvas" id="zenCanvas"></canvas><div class="zen-pattern-select"><button class="zen-pattern-btn active" onclick="setZenPattern(\'spiral\')">èºæ—‹</button><button class="zen-pattern-btn" onclick="setZenPattern(\'wave\')">æ³¢æµª</button><button class="zen-pattern-btn" onclick="setZenPattern(\'circles\')">åœ†ç¯</button></div><div class="zen-progress" id="zenProgress">è·Ÿéšå¼•å¯¼çº¿æç»˜</div></div>';hint.innerHTML='ç¦…ç»•ç”»ï¼šè·Ÿéšå¼•å¯¼çº¿ï¼Œäº«å—è¿‡ç¨‹';initZen()}}
function initBall(){const ball=document.getElementById('theBall'),shadow=document.getElementById('ballShadow'),pressureEl=document.getElementById('ballPressure');ballPressing=false;ballPressure=0;function startPress(e){e.preventDefault();ballPressing=true;pressureEl.style.opacity='1';if(ballRecoverInterval){clearInterval(ballRecoverInterval);ballRecoverInterval=null}ballVibInterval=setInterval(()=>{if(ballPressure<100)ballPressure+=2;updateBallShape();if(ballPressure%10===0)vibrate(10+ballPressure/5)},50)}function endPress(){ballPressing=false;if(ballVibInterval){clearInterval(ballVibInterval);ballVibInterval=null}vibrate([30,20,50]);ballRecoverInterval=setInterval(()=>{if(ballPressure>0){ballPressure-=1;updateBallShape()}else{clearInterval(ballRecoverInterval);ballRecoverInterval=null;pressureEl.style.opacity='0'}},30)}function updateBallShape(){const scale=1-ballPressure*0.003,skewX=ballPressure*0.15,br=50-ballPressure*0.15;ball.style.transform=`scale(${scale},${scale*0.85+0.15}) skewX(${skewX}deg)`;ball.style.borderRadius=`${br}% ${br}% ${50+ballPressure*0.2}% ${50+ballPressure*0.2}%`;shadow.style.width=(140+ballPressure*0.3)+'px';const msgs=['æŒ‰ä½ä¸æ”¾...','ç»§ç»­...','æ„Ÿå—å‹åŠ›é‡Šæ”¾...','å¾ˆå¥½...','è®©å‹åŠ›æµèµ°...','ğŸ‰ å¤ªæ£’äº†ï¼'];pressureEl.textContent=msgs[Math.min(Math.floor(ballPressure/20),5)]}ball.ontouchstart=ball.onmousedown=startPress;ball.ontouchend=ball.onmouseup=ball.ontouchcancel=ball.onmouseleave=endPress}
function stopBallVibration(){if(ballVibInterval){clearInterval(ballVibInterval);ballVibInterval=null}if(ballRecoverInterval){clearInterval(ballRecoverInterval);ballRecoverInterval=null}}
function initSand(){const canvas=document.getElementById('sandCanvas'),ctx=canvas.getContext('2d');canvas.width=canvas.offsetWidth*2;canvas.height=canvas.offsetHeight*2;ctx.scale(2,2);drawSandBase(ctx,canvas.offsetWidth,canvas.offsetHeight);sandCtx=ctx;sandHasDrawn=false;function getPos(e){const r=canvas.getBoundingClientRect(),t=e.touches?e.touches[0]:e;return{x:t.clientX-r.left,y:t.clientY-r.top}}canvas.ontouchstart=canvas.onmousedown=e=>{e.preventDefault();sandDrawing=true;const p=getPos(e);sandLastX=p.x;sandLastY=p.y;if(!sandHasDrawn){document.getElementById('sandGuide').classList.add('hidden');sandHasDrawn=true}};canvas.ontouchmove=canvas.onmousemove=e=>{if(!sandDrawing)return;e.preventDefault();const p=getPos(e);sandCtx.strokeStyle='#8b6914';sandCtx.lineWidth=10+Math.random()*5;sandCtx.lineCap='round';sandCtx.beginPath();sandCtx.moveTo(sandLastX,sandLastY);sandCtx.lineTo(p.x,p.y);sandCtx.stroke();sandLastX=p.x;sandLastY=p.y;vibrate(3)};canvas.ontouchend=canvas.onmouseup=canvas.ontouchcancel=()=>sandDrawing=false}
function drawSandBase(ctx,w,h){const grad=ctx.createLinearGradient(0,0,0,h);grad.addColorStop(0,'#d4a574');grad.addColorStop(1,'#c49a6c');ctx.fillStyle=grad;ctx.fillRect(0,0,w,h);for(let i=0;i<2000;i++){ctx.fillStyle=`rgba(${180+Math.random()*40},${140+Math.random()*30},${90+Math.random()*20},${0.3+Math.random()*0.3})`;ctx.fillRect(Math.random()*w,Math.random()*h,1,1)}}
function shakeSand(){vibrate([30,20,30,20,50]);const canvas=document.getElementById('sandCanvas');if(sandCtx){drawSandBase(sandCtx,canvas.offsetWidth,canvas.offsetHeight);sandHasDrawn=false;document.getElementById('sandGuide').classList.remove('hidden')}}
function initZen(){const canvas=document.getElementById('zenCanvas'),ctx=canvas.getContext('2d');canvas.width=canvas.offsetWidth*2;canvas.height=canvas.offsetHeight*2;ctx.scale(2,2);ctx.fillStyle='#f5f0e6';ctx.fillRect(0,0,canvas.offsetWidth,canvas.offsetHeight);zenCtx=ctx;zenStrokes=0;drawZenGuide();function getPos(e){const r=canvas.getBoundingClientRect(),t=e.touches?e.touches[0]:e;return{x:t.clientX-r.left,y:t.clientY-r.top}}canvas.ontouchstart=canvas.onmousedown=e=>{e.preventDefault();zenDrawing=true;const p=getPos(e);zenLastX=p.x;zenLastY=p.y};canvas.ontouchmove=canvas.onmousemove=e=>{if(!zenDrawing)return;e.preventDefault();const p=getPos(e);zenCtx.strokeStyle='#2d3436';zenCtx.lineWidth=2;
zenCtx.lineCap='round';zenCtx.beginPath();zenCtx.moveTo(zenLastX,zenLastY);zenCtx.lineTo(p.x,p.y);zenCtx.stroke();zenLastX=p.x;zenLastY=p.y;zenStrokes++;if(zenStrokes%20===0)vibrate(5);updateZenProgress()};canvas.ontouchend=canvas.onmouseup=canvas.ontouchcancel=()=>zenDrawing=false}
function setZenPattern(pattern){zenPattern=pattern;document.querySelectorAll('.zen-pattern-btn').forEach(b=>b.classList.remove('active'));event.target.classList.add('active');const canvas=document.getElementById('zenCanvas');zenCtx.fillStyle='#f5f0e6';zenCtx.fillRect(0,0,canvas.offsetWidth,canvas.offsetHeight);zenStrokes=0;drawZenGuide();document.getElementById('zenProgress').textContent='è·Ÿéšå¼•å¯¼çº¿æç»˜'}
function drawZenGuide(){const canvas=document.getElementById('zenCanvas'),w=canvas.offsetWidth,h=canvas.offsetHeight,cx=w/2,cy=h/2;zenCtx.strokeStyle='rgba(0,0,0,0.1)';zenCtx.lineWidth=1;zenCtx.setLineDash([5,5]);if(zenPattern==='spiral'){zenCtx.beginPath();for(let i=0;i<720;i++){const angle=i*Math.PI/180,r=10+i*0.15,x=cx+r*Math.cos(angle),y=cy+r*Math.sin(angle);i===0?zenCtx.moveTo(x,y):zenCtx.lineTo(x,y)}zenCtx.stroke()}else if(zenPattern==='wave'){for(let row=0;row<5;row++){zenCtx.beginPath();for(let x=20;x<w-20;x++){const y=60+row*50+Math.sin(x*0.05)*15;x===20?zenCtx.moveTo(x,y):zenCtx.lineTo(x,y)}zenCtx.stroke()}}else{for(let i=1;i<=5;i++){zenCtx.beginPath();zenCtx.arc(cx,cy,i*25,0,Math.PI*2);zenCtx.stroke()}}zenCtx.setLineDash([])}
function updateZenProgress(){const msgs=['åˆšå¼€å§‹...','ç»§ç»­æç»˜...','å¾ˆå¥½ï¼Œä¿æŒä¸“æ³¨...','è¿›å…¥å¿ƒæµçŠ¶æ€...','ğŸ§˜ å®Œç¾çš„ä¸“æ³¨'];document.getElementById('zenProgress').textContent=msgs[Math.min(Math.floor(zenStrokes/100),4)]}
</script>
</body>
</html>
